
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Main_Conversion2NWB</title><meta name="generator" content="MATLAB 9.14"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2023-08-17"><meta name="DC.source" content="Main_Conversion2NWB.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; }

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }
span.typesection { color:#A0522D }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#3">Main Parameters</a></li><li><a href="#4">Loading of the data structures</a></li><li><a href="#5">Create nwb Structure</a></li><li><a href="#6">Subject information</a></li><li><a href="#7">Trials</a></li><li><a href="#9">Stimuli and Optogenetic timestamps</a></li><li><a href="#10">Extracellular ephys data</a></li><li><a href="#11">Spike data</a></li><li><a href="#12">Whisker angle data from DLC</a></li><li><a href="#13">Jaw Opening data from DLC</a></li><li><a href="#15">Add_saturation Epochs (NON MANDATORY - CAN BE COMMENTED, some local path to change inside,...)</a></li><li><a href="#16">Write NWB</a></li></ul></div><pre class="codeinput">        load(<span class="string">'Z:\analysis\Parviz_Ghaderi\ANALYSIS\DataStructure\Lastvesrion\AllData.mat'</span>)
</pre><p>Your list of mice</p><pre class="codeinput">        Mouse_list = {<span class="string">'PG085'</span>};
        M = 1  <span class="comment">% loop over mice</span>
</pre><pre class="codeoutput">
M =

     1

</pre><h2 id="3">Main Parameters</h2><p>Parameters</p><pre class="codeinput">        Mouse = Mouse_list{M};
        probe = <span class="string">'-probe0'</span>; <span class="comment">% '' if no multiple probes</span>
        rec_day = <span class="string">''</span>;
        disp([<span class="string">'Processing Mouse '</span> Mouse probe])
        Brain_Region = <span class="string">'A1'</span>;
        Task = <span class="string">'Context task'</span>;

        <span class="comment">% Raw Data identifiers</span>

        glk_id = 0; <span class="comment">% Spike GLX identifier</span>
        imec_nb = 0; <span class="comment">%imec number</span>

        <span class="comment">% Get the correct Mouse identifier from our local mouse Database (Tick@lab)</span>

        probe_nb = 1; <span class="comment">%??</span>
</pre><pre class="codeoutput">Processing Mouse PG085-probe0
</pre><h2 id="4">Loading of the data structures</h2><p>Meta data on server</p><pre class="codeinput">        [meta_ap] = ReadMeta([<span class="string">'PG085_12_13_2022_g0_t0.imec0.ap.meta'</span>], [<span class="string">'D:\Neuro_Pixel_Data\PG085\RECORDING\ELECTROPHYSIOLOGY\12_13_2022\PG085_12_13_2022_g0\PG085_12_13_2022_g0_imec0'</span>]);
        [meta_lfp] = ReadMeta([<span class="string">'PG085_12_13_2022_g0_t0.imec0.lf.meta'</span>], [<span class="string">'D:\Neuro_Pixel_Data\PG085\RECORDING\ELECTROPHYSIOLOGY\12_13_2022\PG085_12_13_2022_g0\PG085_12_13_2022_g0_imec0'</span>]);
        [meta_nidaq] = ReadMeta([<span class="string">'PG085_12_13_2022_g0_t0.nidq.bin'</span>], [<span class="string">'D:\Neuro_Pixel_Data\PG085\RECORDING\ELECTROPHYSIOLOGY\12_13_2022\PG085_12_13_2022_g0'</span>]);

        <span class="comment">% Identifier</span>
        session = meta_ap.fileCreateTime(1:end-9);
        session(regexp(session,<span class="string">'-'</span>))=[];
        identifier = [Mouse <span class="string">'_'</span> session probe]; <span class="comment">% unique identifier for saving NWB.</span>
</pre><h2 id="5">Create nwb Structure</h2><pre class="codeinput">        nwb = NwbFile( <span class="keyword">...</span>
            <span class="string">'session_description'</span>, <span class="string">'Neuropixels recording in A1 during Context dependent whisker detection task'</span>,<span class="keyword">...</span>
            <span class="string">'identifier'</span>, identifier, <span class="keyword">...</span>
            <span class="string">'session_start_time'</span>, meta_ap.fileCreateTime, <span class="keyword">...</span>
            <span class="string">'general_experiment_description'</span>, <span class="string">'Neuropixels recording in A1 during Context dependent whisker detection task'</span>,<span class="keyword">...</span>
            <span class="string">'general_experimenter'</span>, <span class="string">'Ghaderi, Raman'</span>, <span class="keyword">...</span><span class="comment"> % optional</span>
            <span class="string">'general_lab'</span>, <span class="string">'LSENS'</span>,<span class="keyword">...</span>
            <span class="string">'general_keywords'</span>, {<span class="string">'key3'</span>, <span class="string">'key1'</span>, <span class="string">'key2'</span>},<span class="keyword">...</span>
            <span class="string">'general_session_id'</span>, identifier, <span class="keyword">...</span><span class="comment"> % optional</span>
            <span class="string">'general_institution'</span>, <span class="string">'Brain Mind Institute-EPFL'</span>,<span class="keyword">...</span><span class="comment"> % optional</span>
            <span class="string">'general_stimulus'</span>,{<span class="string">'pure tone, whisker stimuls, photostim'</span>}, <span class="keyword">...</span>
            <span class="string">'general_surgery'</span>, [<span class="string">'Mice were prepared for '</span>,<span class="keyword">...</span>
            <span class="string">'electrophysiology and ... '</span>,<span class="keyword">...</span>
            <span class="string">'The . '</span>,<span class="keyword">...</span>
            <span class="string">'A .... '</span>
            ]);
</pre><h2 id="6">Subject information</h2><pre class="codeinput">        age=<span class="string">'60'</span>
        DOB=<span class="string">'2022-06-13T00:00:00.000000+02:00'</span>
        Genotype=<span class="string">'VGAT_ChR2-eYFP'</span>
        species=<span class="string">''</span>
        sex=<span class="string">'F'</span>
        description= <span class="string">'Mouse implanted  whisker detection task'</span>


        subject = types.core.Subject( <span class="keyword">...</span>
            <span class="string">'subject_id'</span>, Mouse, <span class="keyword">...</span>
            <span class="string">'date_of_birth'</span>, DOB,<span class="keyword">...</span>
            <span class="string">'age'</span>, age, <span class="keyword">...</span>
            <span class="string">'description'</span>,description, <span class="keyword">...</span>
            <span class="string">'species'</span>, species, <span class="keyword">...</span>
            <span class="string">'genotype'</span>, Genotype, <span class="keyword">...</span>
            <span class="string">'sex'</span>, sex);
        nwb.general_subject = subject;
</pre><pre class="codeoutput">
age =

    '60'


DOB =

    '2022-06-13T00:00:00.000000+02:00'


Genotype =

    'VGAT_ChR2-eYFP'


species =

  0&times;0 empty char array


sex =

    'F'


description =

    'Mouse implanted  whisker detection task'

</pre><h2 id="7">Trials</h2><pre class="codeinput">        start_time=spikeData.Behavior{48, 1}(:,1)  ;
        stop_time=start_time+5;   <span class="comment">% trials index</span>
        Block=repmat(1,length(start_time),1); <span class="comment">% block index block of context or blocks of optotagging</span>
        <span class="comment">% sound condition of each trial</span>
        sound=spikeData.Behavior{48, 1}(:,4) ;
        idgo=sound==0,idnogo=sound==1,idnosound=sound==3;
        sound={};
        sound(idgo)={<span class="string">'go tone'</span>},sound(idnogo)={<span class="string">'nogo tone'</span>},sound(idnosound)={<span class="string">'no tone'</span>},
        sound_freq={};
        sound_freq(idgo)={<span class="string">'8 khz'</span>},sound_freq(idnogo)={<span class="string">'4 khz'</span>},sound_freq(idnosound)={<span class="string">'NaN'</span>},
        sound_amp={};
        sound_amp(1:length(Block))={<span class="string">'80 db'</span>}
        <span class="comment">% whisker condition of each trial</span>
        whisker=spikeData.Behavior{48, 1}(:,5) ;
        <span class="comment">% lick</span>
        lick=spikeData.Behavior{48, 1}(:,6) ;
        lick_time=repmat(200,length(Block),1);  <span class="comment">%should go to behavior later</span>
        <span class="comment">%optogenetics</span>
        optogenetics=zeros(length(Block),1)
        opto_start_time=zeros(length(Block),1)
        opto_end_time=zeros(length(Block),1)
        opto_power=zeros(length(Block),1)
        opto_freq=zeros(length(Block),1)

        <span class="comment">% what else ?????????????</span>
</pre><pre class="codeoutput">
idgo =

  533&times;1 logical array

   0
   1
   0
   1
   0
   1
   0
   0
   0
   0
   1
   0
   1
   1
   1
   0
   0
   1
   1
   0
   0
   0
   0
   0
   0
   1
   1
   1
   0
   0
   0
   1
   0
   1
   0
   1
   1
   0
   1
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   1
   0
   1
   0
   1
   0
   0
   1
   1
   0
   1
   1
   1
   1
   1
   0
   0
   1
   0
   1
   0
   1
   0
   0
   1
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   1
   0
   0
   0
   0
   0
   1
   1
   0
   0
   1
   1
   0
   0
   0
   0
   1
   0
   0
   1
   0
   0
   0
   0
   1
   1
   0
   1
   0
   0
   0
   1
   1
   0
   1
   1
   0
   0
   0
   1
   1
   1
   0
   1
   0
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   0
   1
   1
   0
   0
   0
   1
   0
   0
   1
   0
   0
   1
   1
   0
   0
   0
   0
   0
   0
   1
   1
   0
   0
   1
   1
   1
   1
   0
   1
   1
   0
   0
   0
   0
   1
   0
   0
   0
   1
   1
   0
   0
   1
   1
   0
   0
   1
   1
   0
   1
   1
   0
   0
   0
   0
   0
   1
   1
   0
   0
   0
   1
   0
   0
   0
   1
   0
   1
   0
   1
   1
   0
   0
   0
   0
   0
   0
   1
   1
   1
   0
   0
   1
   0
   1
   0
   1
   0
   0
   0
   0
   0
   1
   1
   1
   0
   1
   0
   0
   0
   0
   0
   0
   1
   0
   1
   0
   0
   1
   1
   0
   1
   0
   0
   1
   1
   1
   0
   1
   0
   0
   1
   0
   0
   0
   0
   1
   1
   0
   0
   0
   1
   1
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   1
   1
   0
   0
   0
   1
   0
   0
   1
   1
   1
   1
   0
   0
   1
   0
   1
   1
   0
   1
   1
   0
   0
   0
   0
   1
   0
   1
   1
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   0
   1
   1
   1
   0
   0
   0
   1
   0
   0
   0
   0
   1
   1
   1
   1
   0
   1
   0
   0
   0
   0
   0
   1
   1
   0
   1
   0
   1
   0
   1
   0
   1
   0
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   0
   0
   1
   0
   1
   0
   1
   1
   1
   0
   1
   0
   0
   0
   1
   1
   0
   1
   1
   0
   0
   1
   1
   0
   0
   0
   0
   1
   1
   1
   1
   1
   0
   0
   0
   0
   1
   1
   0
   0
   0
   0
   1
   0
   0
   0
   1
   0
   1
   0
   0
   0
   0
   0
   0
   1
   1
   0
   0
   1
   0
   1
   0
   1
   1
   0
   1
   0
   1
   1
   1
   0
   1
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   1
   0
   0
   0
   1
   1
   1
   0
   0
   0
   1
   1
   0
   0
   1
   0
   0
   1
   1
   1
   0
   0
   0
   1
   0
   0
   0
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   0
   1
   0
   1
   1
   0
   0
   0
   1
   1
   1
   1
   0
   1
   0
   0
   0
   1
   0
   1
   0
   0
   1
   0
   1
   1
   0
   1
   0
   0
   0
   0
   0
   1
   1
   0
   1
   1
   0
   1
   0
   0


idnogo =

  533&times;1 logical array

   1
   0
   1
   0
   1
   0
   0
   1
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   0
   1
   0
   1
   1
   1
   0
   0
   0
   0
   1
   1
   1
   0
   0
   0
   1
   0
   0
   0
   0
   0
   1
   1
   1
   0
   1
   0
   1
   0
   0
   1
   0
   1
   0
   1
   0
   0
   1
   0
   0
   1
   0
   0
   0
   0
   0
   1
   1
   0
   1
   0
   0
   0
   1
   1
   0
   0
   0
   1
   0
   1
   1
   1
   0
   0
   0
   0
   1
   0
   1
   1
   1
   0
   0
   1
   0
   0
   0
   1
   1
   1
   1
   0
   1
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   1
   1
   0
   0
   1
   0
   0
   1
   0
   1
   0
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   1
   0
   1
   0
   0
   1
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   1
   1
   0
   1
   1
   0
   0
   0
   0
   0
   0
   0
   0
   0
   0
   0
   0
   1
   1
   1
   1
   0
   1
   1
   1
   0
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   0
   0
   1
   0
   1
   0
   1
   0
   1
   1
   1
   0
   1
   0
   0
   0
   0
   0
   1
   1
   1
   1
   1
   1
   0
   1
   0
   1
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   0
   1
   1
   0
   0
   0
   1
   0
   0
   0
   1
   1
   1
   0
   0
   0
   1
   0
   0
   1
   0
   1
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   0
   0
   1
   1
   0
   1
   0
   0
   1
   0
   0
   0
   1
   1
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   1
   1
   1
   0
   1
   0
   0
   0
   0
   1
   1
   1
   0
   0
   0
   1
   0
   0
   0
   0
   0
   1
   0
   1
   1
   1
   1
   1
   0
   0
   1
   0
   1
   0
   0
   0
   0
   0
   1
   0
   1
   0
   1
   1
   0
   1
   1
   0
   1
   0
   1
   0
   0
   0
   1
   0
   1
   0
   0
   0
   0
   0
   1
   1
   1
   0
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   1
   0
   0
   0
   0
   0
   1
   1
   0
   1
   0
   0
   1
   1
   1
   1
   0
   0
   1
   1
   0
   0
   0
   0
   1
   0
   0
   1
   1
   0
   0
   0
   1
   0
   1
   0
   1
   0
   0
   1
   0
   1
   0
   0
   0
   1
   0
   0
   0
   1
   0
   1
   1
   1
   1
   0
   1
   0
   0
   1
   1
   0
   0
   0
   0
   0
   1
   0
   0
   1
   1
   0
   0
   1
   0
   0
   0
   0
   1
   1
   0
   1
   0
   1
   1
   1
   0
   0
   1
   1
   0
   1
   1
   1
   1
   0
   1
   0
   0
   0
   0
   1
   0
   0
   0
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   0
   0
   1
   0
   0
   0
   0
   1
   1
   1
   0
   1
   0
   0
   0
   0
   0
   1
   0
   1
   1


sound =

  1&times;531 cell array

  Columns 1 through 5

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 6 through 10

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 11 through 15

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 16 through 20

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 21 through 24

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 25 through 29

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 30 through 34

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 35 through 39

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 40 through 44

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 45 through 49

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 50 through 54

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 55 through 59

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 60 through 64

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 65 through 69

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 70 through 74

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 75 through 79

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 80 through 84

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 85 through 89

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 90 through 94

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 95 through 99

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 100 through 104

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 105 through 109

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 110 through 114

    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 115 through 119

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 120 through 124

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 125 through 129

    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 130 through 134

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 135 through 139

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 140 through 144

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 145 through 149

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 150 through 154

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 155 through 158

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 159 through 163

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 164 through 168

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 169 through 173

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 174 through 178

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 179 through 183

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 184 through 188

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 189 through 193

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 194 through 198

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 199 through 203

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 204 through 208

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 209 through 213

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 214 through 217

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 218 through 222

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 223 through 227

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 228 through 232

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 233 through 237

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 238 through 242

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 243 through 247

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 248 through 252

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 253 through 257

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 258 through 262

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 263 through 267

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 268 through 272

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 273 through 277

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 278 through 282

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 283 through 287

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 288 through 292

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 293 through 297

    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 298 through 302

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 303 through 307

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 308 through 312

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 313 through 317

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 318 through 322

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 323 through 327

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 328 through 332

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 333 through 337

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 338 through 342

    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 343 through 347

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 348 through 352

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 353 through 357

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 358 through 362

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 363 through 367

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 368 through 372

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 373 through 377

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 378 through 382

    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 383 through 387

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 388 through 392

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 393 through 397

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 398 through 402

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 403 through 407

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 408 through 412

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 413 through 417

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 418 through 422

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 423 through 427

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 428 through 432

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 433 through 437

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 438 through 442

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 443 through 447

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 448 through 452

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 453 through 457

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 458 through 462

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 463 through 467

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 468 through 472

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 473 through 477

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 478 through 482

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 483 through 487

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 488 through 492

    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 493 through 497

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 498 through 502

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 503 through 507

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 508 through 512

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 513 through 517

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 518 through 522

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 523 through 527

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 528 through 531

    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}


sound =

  1&times;533 cell array

  Columns 1 through 4

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 5 through 8

    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 9 through 13

    {0&times;0 double}    {0&times;0 double}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 14 through 18

    {'go tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}

  Columns 19 through 22

    {'go tone'}    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 23 through 26

    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}    {'go tone'}

  Columns 27 through 30

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 31 through 34

    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 35 through 39

    {'nogo tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 40 through 43

    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 44 through 47

    {'go tone'}    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 48 through 51

    {0&times;0 double}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 52 through 55

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 56 through 59

    {0&times;0 double}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 60 through 64

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 65 through 68

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 69 through 72

    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 73 through 76

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {0&times;0 double}

  Columns 77 through 80

    {0&times;0 double}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 81 through 84

    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}    {'go tone'}

  Columns 85 through 88

    {0&times;0 double}    {'go tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 89 through 92

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 93 through 97

    {'go tone'}    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 98 through 101

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 102 through 106

    {'go tone'}    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 107 through 111

    {0&times;0 double}    {0&times;0 double}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 112 through 115

    {0&times;0 double}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 116 through 120

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 121 through 124

    {'go tone'}    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 125 through 129

    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 130 through 133

    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 134 through 138

    {'go tone'}    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 139 through 142

    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}

  Columns 143 through 146

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 147 through 150

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 151 through 154

    {0&times;0 double}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 155 through 158

    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 159 through 163

    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 164 through 168

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 169 through 172

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 173 through 176

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 177 through 180

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 181 through 185

    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 186 through 189

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 190 through 193

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 194 through 197

    {'nogo tone'}    {0&times;0 double}    {0&times;0 double}    {'nogo tone'}

  Columns 198 through 202

    {'go tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {0&times;0 double}

  Columns 203 through 206

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 207 through 211

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 212 through 215

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 216 through 220

    {0&times;0 double}    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}

  Columns 221 through 224

    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}

  Columns 225 through 228

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 229 through 232

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 233 through 237

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 238 through 241

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 242 through 245

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 246 through 249

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 250 through 254

    {'go tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}    {'nogo tone'}

  Columns 255 through 259

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 260 through 263

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 264 through 267

    {0&times;0 double}    {0&times;0 double}    {'nogo tone'}    {0&times;0 double}

  Columns 268 through 271

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 272 through 275

    {'nogo tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 276 through 279

    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {'nogo tone'}

  Columns 280 through 283

    {0&times;0 double}    {'nogo tone'}    {0&times;0 double}    {'go tone'}

  Columns 284 through 287

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 288 through 291

    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {'nogo tone'}

  Columns 292 through 296

    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 297 through 300

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 301 through 305

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 306 through 309

    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 310 through 314

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 315 through 318

    {'nogo tone'}    {0&times;0 double}    {0&times;0 double}    {'nogo tone'}

  Columns 319 through 322

    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}

  Columns 323 through 326

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 327 through 331

    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 332 through 335

    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 336 through 340

    {'nogo tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 341 through 344

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 345 through 348

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 349 through 353

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 354 through 358

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'go tone'}

  Columns 359 through 362

    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}    {0&times;0 double}

  Columns 363 through 366

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 367 through 370

    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}

  Columns 371 through 374

    {'nogo tone'}    {0&times;0 double}    {0&times;0 double}    {'go tone'}

  Columns 375 through 379

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 380 through 383

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'nogo tone'}

  Columns 384 through 387

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 388 through 392

    {0&times;0 double}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 393 through 397

    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}    {'nogo tone'}

  Columns 398 through 402

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 403 through 406

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 407 through 410

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 411 through 414

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 415 through 418

    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 419 through 422

    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 423 through 426

    {0&times;0 double}    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}

  Columns 427 through 431

    {'go tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}

  Columns 432 through 436

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 437 through 441

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 442 through 446

    {'go tone'}    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 447 through 450

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 451 through 454

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 455 through 458

    {'go tone'}    {0&times;0 double}    {'nogo tone'}    {'nogo tone'}

  Columns 459 through 463

    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 464 through 467

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 468 through 471

    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 472 through 476

    {'go tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}    {'nogo tone'}

  Columns 477 through 480

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {0&times;0 double}

  Columns 481 through 484

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 485 through 488

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 489 through 492

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 493 through 497

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {0&times;0 double}

  Columns 498 through 502

    {0&times;0 double}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 503 through 507

    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}    {0&times;0 double}

  Columns 508 through 512

    {'nogo tone'}    {'go tone'}    {0&times;0 double}    {'go tone'}    {0&times;0 double}

  Columns 513 through 517

    {0&times;0 double}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 518 through 521

    {0&times;0 double}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 522 through 525

    {'nogo tone'}    {0&times;0 double}    {'nogo tone'}    {'go tone'}

  Columns 526 through 530

    {'go tone'}    {0&times;0 double}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 531 through 533

    {'go tone'}    {'nogo tone'}    {'nogo tone'}


sound =

  1&times;533 cell array

  Columns 1 through 4

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 5 through 9

    {'nogo tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}    {'no tone'}

  Columns 10 through 14

    {'no tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 15 through 19

    {'go tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 20 through 23

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 24 through 28

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 29 through 32

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 33 through 37

    {'no tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 38 through 42

    {'no tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 43 through 46

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'no tone'}

  Columns 47 through 51

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 52 through 56

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}

  Columns 57 through 61

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 62 through 66

    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 67 through 71

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}

  Columns 72 through 76

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}

  Columns 77 through 80

    {'no tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 81 through 85

    {'nogo tone'}    {'nogo tone'}    {'no tone'}    {'go tone'}    {'no tone'}

  Columns 86 through 89

    {'go tone'}    {'nogo tone'}    {'no tone'}    {'nogo tone'}

  Columns 90 through 93

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 94 through 98

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 99 through 102

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 103 through 107

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'no tone'}    {'no tone'}

  Columns 108 through 112

    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}

  Columns 113 through 116

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 117 through 121

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 122 through 126

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 127 through 131

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}

  Columns 132 through 136

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'no tone'}

  Columns 137 through 141

    {'go tone'}    {'no tone'}    {'nogo tone'}    {'no tone'}    {'nogo tone'}

  Columns 142 through 146

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'no tone'}

  Columns 147 through 151

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}

  Columns 152 through 155

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 156 through 159

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 160 through 164

    {'no tone'}    {'go tone'}    {'go tone'}    {'no tone'}    {'no tone'}

  Columns 165 through 169

    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'no tone'}

  Columns 170 through 173

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 174 through 177

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 178 through 182

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}

  Columns 183 through 186

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 187 through 191

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 192 through 196

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'no tone'}    {'no tone'}

  Columns 197 through 201

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}

  Columns 202 through 206

    {'no tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'no tone'}

  Columns 207 through 211

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 212 through 216

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'no tone'}    {'no tone'}

  Columns 217 through 221

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 222 through 226

    {'no tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 227 through 230

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 231 through 235

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 236 through 240

    {'go tone'}    {'no tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 241 through 244

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 245 through 249

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'no tone'}

  Columns 250 through 254

    {'go tone'}    {'go tone'}    {'no tone'}    {'go tone'}    {'nogo tone'}

  Columns 255 through 259

    {'no tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 260 through 264

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}

  Columns 265 through 269

    {'no tone'}    {'nogo tone'}    {'no tone'}    {'go tone'}    {'go tone'}

  Columns 270 through 273

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 274 through 278

    {'go tone'}    {'no tone'}    {'nogo tone'}    {'no tone'}    {'go tone'}

  Columns 279 through 283

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'no tone'}    {'go tone'}

  Columns 284 through 287

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 288 through 292

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'nogo tone'}    {'no tone'}

  Columns 293 through 297

    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 298 through 302

    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 303 through 307

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}

  Columns 308 through 312

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 313 through 317

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'no tone'}    {'no tone'}

  Columns 318 through 321

    {'nogo tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}

  Columns 322 through 325

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 326 through 330

    {'no tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 331 through 335

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}    {'no tone'}

  Columns 336 through 340

    {'nogo tone'}    {'no tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 341 through 344

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 345 through 348

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 349 through 353

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 354 through 358

    {'go tone'}    {'no tone'}    {'go tone'}    {'no tone'}    {'go tone'}

  Columns 359 through 362

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'no tone'}

  Columns 363 through 366

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 367 through 370

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}

  Columns 371 through 375

    {'nogo tone'}    {'no tone'}    {'no tone'}    {'go tone'}    {'nogo tone'}

  Columns 376 through 380

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 381 through 384

    {'no tone'}    {'go tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 385 through 389

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}    {'go tone'}

  Columns 390 through 394

    {'go tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 395 through 399

    {'no tone'}    {'no tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 400 through 404

    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 405 through 409

    {'nogo tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 410 through 413

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 414 through 418

    {'go tone'}    {'no tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 419 through 423

    {'no tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}    {'no tone'}

  Columns 424 through 428

    {'no tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 429 through 433

    {'no tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 434 through 438

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}

  Columns 439 through 443

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 444 through 448

    {'go tone'}    {'no tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}

  Columns 449 through 452

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 453 through 457

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}

  Columns 458 through 462

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'no tone'}

  Columns 463 through 467

    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'nogo tone'}

  Columns 468 through 472

    {'nogo tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}    {'go tone'}

  Columns 473 through 477

    {'go tone'}    {'go tone'}    {'no tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 478 through 481

    {'go tone'}    {'nogo tone'}    {'no tone'}    {'nogo tone'}

  Columns 482 through 485

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}

  Columns 486 through 489

    {'nogo tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Columns 490 through 493

    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}    {'go tone'}

  Columns 494 through 498

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}    {'no tone'}

  Columns 499 through 503

    {'nogo tone'}    {'go tone'}    {'go tone'}    {'go tone'}    {'go tone'}

  Columns 504 through 508

    {'no tone'}    {'go tone'}    {'no tone'}    {'no tone'}    {'nogo tone'}

  Columns 509 through 513

    {'go tone'}    {'no tone'}    {'go tone'}    {'no tone'}    {'no tone'}

  Columns 514 through 518

    {'go tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}

  Columns 519 through 522

    {'go tone'}    {'nogo tone'}    {'nogo tone'}    {'nogo tone'}

  Columns 523 through 527

    {'no tone'}    {'nogo tone'}    {'go tone'}    {'go tone'}    {'no tone'}

  Columns 528 through 532

    {'go tone'}    {'go tone'}    {'nogo tone'}    {'go tone'}    {'nogo tone'}

  Column 533

    {'nogo tone'}


sound_freq =

  1&times;531 cell array

  Columns 1 through 5

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 6 through 10

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 11 through 15

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 16 through 20

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 21 through 24

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 25 through 29

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 30 through 34

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 35 through 39

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 40 through 44

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 45 through 49

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 50 through 54

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 55 through 59

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 60 through 64

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 65 through 69

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 70 through 74

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 75 through 79

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 80 through 84

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 85 through 89

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 90 through 94

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 95 through 99

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 100 through 104

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 105 through 109

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 110 through 114

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 115 through 119

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 120 through 124

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 125 through 129

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 130 through 134

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 135 through 139

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 140 through 144

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 145 through 149

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 150 through 154

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 155 through 158

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 159 through 163

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 164 through 168

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 169 through 173

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 174 through 178

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 179 through 183

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 184 through 188

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 189 through 193

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 194 through 198

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 199 through 203

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 204 through 208

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 209 through 213

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 214 through 217

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 218 through 222

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 223 through 227

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 228 through 232

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 233 through 237

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 238 through 242

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 243 through 247

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 248 through 252

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 253 through 257

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 258 through 262

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 263 through 267

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 268 through 272

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 273 through 277

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 278 through 282

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 283 through 287

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 288 through 292

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 293 through 297

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 298 through 302

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 303 through 307

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 308 through 312

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 313 through 317

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 318 through 322

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 323 through 327

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 328 through 332

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 333 through 337

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 338 through 342

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 343 through 347

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 348 through 352

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 353 through 357

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 358 through 362

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 363 through 367

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 368 through 372

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 373 through 377

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 378 through 382

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 383 through 387

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 388 through 392

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 393 through 397

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 398 through 402

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 403 through 407

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 408 through 412

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 413 through 417

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 418 through 422

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 423 through 427

    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 428 through 432

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 433 through 437

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 438 through 442

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 443 through 447

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 448 through 452

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 453 through 457

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 458 through 462

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 463 through 467

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 468 through 472

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 473 through 477

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 478 through 482

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 483 through 487

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 488 through 492

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 493 through 497

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 498 through 502

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 503 through 507

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 508 through 512

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 513 through 517

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 518 through 522

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}

  Columns 523 through 527

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 528 through 531

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}


sound_freq =

  1&times;533 cell array

  Columns 1 through 6

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 7 through 11

    {0&times;0 double}    {'4 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 12 through 16

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 17 through 21

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {0&times;0 double}

  Columns 22 through 26

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 27 through 32

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 33 through 37

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 38 through 42

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'4 khz'}    {'4 khz'}

  Columns 43 through 47

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 48 through 52

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 53 through 57

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 58 through 63

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 64 through 69

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 70 through 74

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 75 through 79

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}    {'8 khz'}

  Columns 80 through 84

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 85 through 89

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 90 through 94

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 95 through 99

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 100 through 104

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {0&times;0 double}

  Columns 105 through 109

    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}

  Columns 110 through 114

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}

  Columns 115 through 120

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 121 through 125

    {'8 khz'}    {'4 khz'}    {0&times;0 double}    {'4 khz'}    {'8 khz'}

  Columns 126 through 130

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 131 through 135

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 136 through 140

    {0&times;0 double}    {'8 khz'}    {0&times;0 double}    {'4 khz'}    {0&times;0 double}

  Columns 141 through 145

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 146 through 150

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 151 through 155

    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 156 through 160

    {'4 khz'}    {0&times;0 double}    {'4 khz'}    {'4 khz'}    {0&times;0 double}

  Columns 161 through 165

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}

  Columns 166 through 170

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 171 through 176

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 177 through 181

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 182 through 186

    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 187 through 192

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 193 through 197

    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}

  Columns 198 through 202

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}    {0&times;0 double}

  Columns 203 through 207

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 208 through 213

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 214 through 218

    {'4 khz'}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}    {0&times;0 double}

  Columns 219 through 223

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 224 through 229

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 230 through 234

    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {'4 khz'}    {'8 khz'}

  Columns 235 through 239

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}

  Columns 240 through 245

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 246 through 250

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 251 through 255

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {0&times;0 double}

  Columns 256 through 261

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 262 through 266

    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}

  Columns 267 through 271

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 272 through 276

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 277 through 281

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 282 through 286

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 287 through 291

    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}

  Columns 292 through 296

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 297 through 302

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 303 through 307

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 308 through 312

    {'4 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 313 through 317

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 318 through 322

    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}    {'4 khz'}

  Columns 323 through 327

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 328 through 333

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 334 through 338

    {0&times;0 double}    {0&times;0 double}    {'4 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 339 through 344

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 345 through 350

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 351 through 355

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 356 through 360

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {0&times;0 double}

  Columns 361 through 365

    {'4 khz'}    {0&times;0 double}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 366 through 370

    {'4 khz'}    {'4 khz'}    {0&times;0 double}    {'4 khz'}    {'8 khz'}

  Columns 371 through 375

    {'4 khz'}    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'4 khz'}

  Columns 376 through 380

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 381 through 385

    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}

  Columns 386 through 390

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'8 khz'}

  Columns 391 through 395

    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 396 through 400

    {0&times;0 double}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 401 through 405

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 406 through 410

    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 411 through 415

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {0&times;0 double}

  Columns 416 through 420

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 421 through 425

    {0&times;0 double}    {'4 khz'}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}

  Columns 426 through 430

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}

  Columns 431 through 436

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 437 through 442

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 443 through 447

    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}    {'4 khz'}

  Columns 448 through 453

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 454 through 458

    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {'4 khz'}    {'4 khz'}

  Columns 459 through 463

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {0&times;0 double}

  Columns 464 through 469

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 470 through 474

    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 475 through 479

    {0&times;0 double}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 480 through 484

    {0&times;0 double}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 485 through 490

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 491 through 496

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 497 through 501

    {0&times;0 double}    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 502 through 506

    {'8 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {0&times;0 double}

  Columns 507 through 511

    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {0&times;0 double}    {'8 khz'}

  Columns 512 through 516

    {0&times;0 double}    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 517 through 521

    {'8 khz'}    {0&times;0 double}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 522 through 526

    {'4 khz'}    {0&times;0 double}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 527 through 531

    {0&times;0 double}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 532 through 533

    {'4 khz'}    {'4 khz'}


sound_freq =

  1&times;533 cell array

  Columns 1 through 6

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 7 through 12

    {'NaN'}    {'4 khz'}    {'NaN'}    {'NaN'}    {'8 khz'}    {'4 khz'}

  Columns 13 through 18

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}

  Columns 19 through 24

    {'8 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'4 khz'}    {'4 khz'}

  Columns 25 through 30

    {'NaN'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 31 through 36

    {'4 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 37 through 42

    {'8 khz'}    {'NaN'}    {'8 khz'}    {'NaN'}    {'4 khz'}    {'4 khz'}

  Columns 43 through 48

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'NaN'}

  Columns 49 through 54

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 55 through 60

    {'8 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 61 through 66

    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 67 through 72

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}

  Columns 73 through 78

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}    {'NaN'}    {'4 khz'}

  Columns 79 through 84

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}

  Columns 85 through 90

    {'NaN'}    {'8 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'4 khz'}

  Columns 91 through 96

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}

  Columns 97 through 102

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 103 through 108

    {'4 khz'}    {'NaN'}    {'8 khz'}    {'NaN'}    {'NaN'}    {'NaN'}

  Columns 109 through 114

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}

  Columns 115 through 120

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 121 through 126

    {'8 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 127 through 132

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}    {'4 khz'}    {'4 khz'}

  Columns 133 through 138

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'NaN'}

  Columns 139 through 144

    {'4 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 145 through 150

    {'4 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 151 through 156

    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 157 through 162

    {'NaN'}    {'4 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}

  Columns 163 through 168

    {'NaN'}    {'NaN'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 169 through 174

    {'NaN'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}

  Columns 175 through 180

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 181 through 186

    {'8 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 187 through 192

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}

  Columns 193 through 198

    {'4 khz'}    {'4 khz'}    {'NaN'}    {'NaN'}    {'4 khz'}    {'8 khz'}

  Columns 199 through 204

    {'8 khz'}    {'NaN'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}

  Columns 205 through 210

    {'4 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 211 through 216

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'NaN'}    {'NaN'}

  Columns 217 through 222

    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}

  Columns 223 through 228

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 229 through 234

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}

  Columns 235 through 240

    {'8 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 241 through 246

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 247 through 252

    {'8 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}    {'NaN'}

  Columns 253 through 258

    {'8 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 259 through 264

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}

  Columns 265 through 270

    {'NaN'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 271 through 276

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'4 khz'}

  Columns 277 through 282

    {'NaN'}    {'8 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'NaN'}

  Columns 283 through 288

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 289 through 294

    {'NaN'}    {'8 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}

  Columns 295 through 300

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 301 through 306

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}

  Columns 307 through 312

    {'4 khz'}    {'4 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 313 through 318

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'NaN'}    {'NaN'}    {'4 khz'}

  Columns 319 through 324

    {'8 khz'}    {'NaN'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 325 through 330

    {'4 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 331 through 336

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}    {'NaN'}    {'4 khz'}

  Columns 337 through 342

    {'NaN'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 343 through 348

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}

  Columns 349 through 354

    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 355 through 360

    {'NaN'}    {'8 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'NaN'}

  Columns 361 through 366

    {'4 khz'}    {'NaN'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 367 through 372

    {'4 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'NaN'}

  Columns 373 through 378

    {'NaN'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 379 through 384

    {'8 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 385 through 390

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}    {'8 khz'}

  Columns 391 through 396

    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'NaN'}

  Columns 397 through 402

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 403 through 408

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}

  Columns 409 through 414

    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}

  Columns 415 through 420

    {'NaN'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}

  Columns 421 through 426

    {'NaN'}    {'4 khz'}    {'NaN'}    {'NaN'}    {'4 khz'}    {'4 khz'}

  Columns 427 through 432

    {'8 khz'}    {'8 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'4 khz'}

  Columns 433 through 438

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 439 through 444

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 445 through 450

    {'NaN'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 451 through 456

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'NaN'}

  Columns 457 through 462

    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}

  Columns 463 through 468

    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}

  Columns 469 through 474

    {'8 khz'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}

  Columns 475 through 480

    {'NaN'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'NaN'}

  Columns 481 through 486

    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'4 khz'}

  Columns 487 through 492

    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}

  Columns 493 through 498

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'NaN'}

  Columns 499 through 504

    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}

  Columns 505 through 510

    {'8 khz'}    {'NaN'}    {'NaN'}    {'4 khz'}    {'8 khz'}    {'NaN'}

  Columns 511 through 516

    {'8 khz'}    {'NaN'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'8 khz'}

  Columns 517 through 522

    {'8 khz'}    {'NaN'}    {'8 khz'}    {'4 khz'}    {'4 khz'}    {'4 khz'}

  Columns 523 through 528

    {'NaN'}    {'4 khz'}    {'8 khz'}    {'8 khz'}    {'NaN'}    {'8 khz'}

  Columns 529 through 533

    {'8 khz'}    {'4 khz'}    {'8 khz'}    {'4 khz'}    {'4 khz'}


sound_amp =

  1&times;533 cell array

  Columns 1 through 6

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 7 through 12

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 13 through 18

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 19 through 24

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 25 through 30

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 31 through 36

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 37 through 42

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 43 through 48

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 49 through 54

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 55 through 60

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 61 through 66

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 67 through 72

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 73 through 78

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 79 through 84

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 85 through 90

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 91 through 96

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 97 through 102

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 103 through 108

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 109 through 114

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 115 through 120

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 121 through 126

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 127 through 132

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 133 through 138

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 139 through 144

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 145 through 150

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 151 through 156

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 157 through 162

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 163 through 168

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 169 through 174

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 175 through 180

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 181 through 186

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 187 through 192

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 193 through 198

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 199 through 204

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 205 through 210

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 211 through 216

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 217 through 222

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 223 through 228

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 229 through 234

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 235 through 240

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 241 through 246

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 247 through 252

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 253 through 258

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 259 through 264

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 265 through 270

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 271 through 276

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 277 through 282

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 283 through 288

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 289 through 294

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 295 through 300

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 301 through 306

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 307 through 312

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 313 through 318

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 319 through 324

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 325 through 330

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 331 through 336

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 337 through 342

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 343 through 348

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 349 through 354

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 355 through 360

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 361 through 366

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 367 through 372

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 373 through 378

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 379 through 384

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 385 through 390

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 391 through 396

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 397 through 402

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 403 through 408

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 409 through 414

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 415 through 420

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 421 through 426

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 427 through 432

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 433 through 438

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 439 through 444

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 445 through 450

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 451 through 456

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 457 through 462

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 463 through 468

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 469 through 474

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 475 through 480

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 481 through 486

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 487 through 492

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 493 through 498

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 499 through 504

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 505 through 510

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 511 through 516

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 517 through 522

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 523 through 528

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}

  Columns 529 through 533

    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}    {'80 db'}


optogenetics =

     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0


opto_start_time =

     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0


opto_end_time =

     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0


opto_power =

     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0


opto_freq =

     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0
     0

</pre><pre class="codeinput">        <span class="comment">% Finally adding it to the nwb sturcture</span>
        trials = types.core.TimeIntervals( <span class="keyword">...</span>
            <span class="string">'colnames'</span>, {<span class="string">'start_time'</span>, <span class="string">'stop_time'</span>,<span class="keyword">...</span>
            <span class="string">'Block'</span>,<span class="keyword">...</span>
            <span class="string">'sound'</span>,<span class="string">'sound_freq'</span>,<span class="string">'sound_amp'</span>,<span class="keyword">...</span>
            <span class="string">'optogenetics'</span>,<span class="string">'opto_freq'</span>,<span class="string">'opto_power'</span>,<span class="string">'opto_start_time'</span>,<span class="string">'opto_end_time'</span>,<span class="keyword">...</span>
            <span class="string">'lick'</span>,<span class="string">'lick_time'</span>}, <span class="keyword">...</span>
            <span class="string">'description'</span>, <span class="string">'trial data and properties'</span>, <span class="keyword">...</span>
            <span class="string">'id'</span>, types.hdmf_common.ElementIdentifiers(<span class="string">'data'</span>, 0:numel(Block)-1), <span class="keyword">...</span><span class="comment"> %0 indexed</span>
            <span class="string">'start_time'</span>, types.hdmf_common.VectorData(<span class="string">'data'</span>, start_time, <span class="string">'description'</span>,<span class="string">'start time of trial'</span>), <span class="keyword">...</span>
            <span class="string">'stop_time'</span>, types.hdmf_common.VectorData(<span class="string">'data'</span>, stop_time, <span class="string">'description'</span>,<span class="string">'end of each trial'</span>),<span class="keyword">...</span>
            <span class="string">'Block'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, Block', <span class="string">'description'</span>,<span class="string">'Block number'</span>),<span class="keyword">...</span>
            <span class="string">'sound'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, sound',<span class="string">'description'</span>,<span class="string">'bolean for sound'</span>),<span class="keyword">...</span>
            <span class="string">'sound_freq'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, sound_freq',<span class="string">'description'</span>,<span class="string">'sound frequency'</span>),<span class="keyword">...</span>
            <span class="string">'sound_amp'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, sound_amp',<span class="string">'description'</span>,<span class="string">'sound amplitude'</span>),<span class="keyword">...</span>
            <span class="string">'optogenetics'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, logical(optogenetics'),<span class="string">'description'</span>,<span class="string">'bolean for optogenetics'</span>),<span class="keyword">...</span>
            <span class="string">'opto_freq'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, opto_freq,<span class="string">'description'</span>,<span class="string">'pulse train frequency'</span>),<span class="keyword">...</span>
            <span class="string">'opto_power'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, opto_power,<span class="string">'description'</span>,<span class="string">'laser power'</span>),<span class="keyword">...</span>
            <span class="string">'opto_start_time'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, opto_start_time',<span class="string">'description'</span>,<span class="string">'pulse duration (s)'</span>),<span class="keyword">...</span>
            <span class="string">'opto_end_time'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, opto_end_time',<span class="string">'description'</span>,<span class="string">'individual pulses timestamps'</span>),<span class="keyword">...</span>
            <span class="string">'lick'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, logical(lick'),<span class="string">'description'</span>,<span class="string">'bolean for airpuff'</span>),<span class="keyword">...</span>
            <span class="string">'lick_time'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, lick_time',<span class="string">'description'</span>,<span class="string">'Airpuff duration (s)'</span>));

        nwb.intervals_trials = trials;
</pre><h2 id="9">Stimuli and Optogenetic timestamps</h2><pre class="codeinput">        <span class="comment">% whisker  Stimuli</span>
        whisker_time=spikeData.Behavior{48, 1}(:,2) ;
        whisker_time=whisker_time(~isnan(whisker_time));
        WhiskerStimuli = types.core.TimeSeries(<span class="keyword">...</span>
            <span class="string">'data'</span>, repmat(5,length(whisker_time),1), <span class="keyword">...</span>
            <span class="string">'data_unit'</span>, <span class="string">'Volts'</span>, <span class="keyword">...</span>
            <span class="string">'description'</span>, <span class="string">'whisker Amplitude in V '</span>, <span class="keyword">...</span>
            <span class="string">'timestamps'</span>, whisker_time, <span class="keyword">...</span>
            <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);
        nwb.stimulus_presentation.set(<span class="string">'whisker_time'</span>, WhiskerStimuli);
        WhiskerStimuli_ref = types.untyped.ObjectView(<span class="string">'/stimulus/presentation/whisker_time'</span>);



        <span class="comment">% Sound stimuls</span>
        sound_time=start_time+1.5   <span class="comment">% or real time</span>
        sound_time(idnosound)=[]
        sound_stimuls = types.core.TimeSeries(<span class="keyword">...</span>
            <span class="string">'data'</span>, 5*ones(1,numel(sound_time)), <span class="keyword">...</span>
            <span class="string">'data_unit'</span>, <span class="string">'Volts'</span>, <span class="keyword">...</span>
            <span class="string">'description'</span>, <span class="string">'sound signal in V '</span>, <span class="keyword">...</span>
            <span class="string">'timestamps'</span>, sound_time, <span class="keyword">...</span>
            <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);
        nwb.stimulus_presentation.set(<span class="string">'sound_stimuls'</span>, sound_stimuls);
        sound_stimuls_ref = types.untyped.ObjectView(<span class="string">'/stimulus/presentation/sound_stimuls'</span>);


        <span class="comment">% Optogenetic pulse</span>
        <span class="comment">% device</span>
        laser = types.core.Device(<span class="keyword">...</span>
            <span class="string">'description'</span>, <span class="string">'laser-473nm'</span>, <span class="keyword">...</span>
            <span class="string">'manufacturer'</span>, <span class="string">'.....'</span>);
        nwb.general_devices.set(<span class="string">'laser'</span>, laser);

        <span class="comment">% stimulus site</span>
        ogen_stim_site = types.core.OptogeneticStimulusSite( <span class="keyword">...</span>
            <span class="string">'device'</span>, types.untyped.SoftLink(laser), <span class="keyword">...</span>
            <span class="string">'description'</span>, <span class="string">'PhotoStimulation (ChR2) of VGat ...'</span>, <span class="keyword">...</span>
            <span class="string">'excitation_lambda'</span>, 473.0, <span class="keyword">...</span>
            <span class="string">'location'</span>, <span class="string">'wM2 ()'</span>);

        nwb.general_optogenetics.set(<span class="string">'OptogeneticStimulusSite'</span>, ogen_stim_site);

        <span class="comment">% Adding Timeseries to have power values</span>
        ogen_series = types.core.OptogeneticSeries( <span class="keyword">...</span>
            <span class="string">'description'</span>, <span class="string">'Optogenetic stim pulse data: pulse of .... '</span>, <span class="keyword">...</span>
            <span class="string">'data'</span>, opto_ts.amp, <span class="keyword">...</span>
            <span class="string">'data_unit'</span>, <span class="string">'mW'</span>, <span class="keyword">...</span>
            <span class="string">'site'</span>, types.untyped.SoftLink(ogen_stim_site), <span class="keyword">...</span>
            <span class="string">'timestamps'</span>, opto_ts.ts_on_corr./opto_ts.sr, <span class="keyword">...</span>
            <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);

        nwb.stimulus_presentation.set(<span class="string">'OptogeneticSeries'</span>, ogen_series);



        <span class="comment">% and add more time series</span>
        <span class="comment">%</span>
        <span class="comment">%</span>
        <span class="comment">%</span>
        <span class="comment">%</span>
</pre><pre class="codeoutput">
sound_time =

   1.0e+03 *

    0.0373
    0.0638
    0.1187
    0.1298
    0.1404
    0.1511
    0.1619
    0.1731
    0.1846
    0.1958
    0.2069
    0.2176
    0.2290
    0.2403
    0.2510
    0.2618
    0.2730
    0.2841
    0.2957
    0.3385
    0.3811
    0.3927
    0.4036
    0.4252
    0.4367
    0.4474
    0.4590
    0.4702
    0.4813
    0.4928
    0.5042
    0.5157
    0.5272
    0.5383
    0.5498
    0.5606
    0.5713
    0.5822
    0.5935
    0.6047
    0.6287
    0.6398
    0.6507
    0.6712
    0.6947
    0.7058
    0.7166
    0.7276
    0.7382
    0.7489
    0.7601
    0.7707
    0.7821
    0.7936
    0.8048
    0.8155
    0.8266
    0.8376
    0.8488
    0.8594
    0.8708
    0.8816
    0.8923
    0.9038
    0.9145
    0.9253
    0.9364
    0.9474
    0.9582
    0.9813
    0.9928
    1.0043
    1.0407
    1.0521
    1.0634
    1.0743
    1.0853
    1.0961
    1.1074
    1.1313
    1.1422
    1.1531
    1.1643
    1.1754
    1.1862
    1.2268
    1.2380
    1.2490
    1.2603
    1.2715
    1.3035
    1.3148
    1.3263
    1.3377
    1.3485
    1.3599
    1.3713
    1.3824
    1.3937
    1.4044
    1.4154
    1.4262
    1.4370
    1.4478
    1.4587
    1.4695
    1.4808
    1.4915
    1.5021
    1.5128
    1.5240
    1.5349
    1.5462
    1.5574
    1.5684
    1.5799
    1.6021
    1.6127
    1.6237
    1.6350
    1.6464
    1.6571
    1.6679
    1.6791
    1.6906
    1.7014
    1.7122
    1.7236
    1.7346
    1.7458
    1.7568
    1.7674
    1.7789
    1.7903
    1.8015
    1.8273
    1.8382
    1.8495
    1.8605
    1.8714
    1.8820
    1.8935
    1.9140
    1.9250
    1.9362
    1.9470
    1.9578
    1.9685
    1.9794
    1.9908
    2.0015
    2.0126
    2.0234
    2.0348
    2.0456
    2.0562
    2.0676
    2.0782
    2.0892
    2.1002
    2.1116
    2.1223
    2.1336
    2.1448
    2.1564
    2.1679
    2.1793
    2.1905
    2.2019
    2.2242
    2.2348
    2.2456
    2.2564
    2.2674
    2.2783
    2.2899
    2.3007
    2.3114
    2.3224
    2.3339
    2.3454
    2.3569
    2.3678
    2.3784
    2.3898
    2.4010
    2.4117
    2.4231
    2.4344
    2.4459
    2.4569
    2.4682
    2.4791
    2.4906
    2.5017
    2.5130
    2.5343
    2.5457
    2.5569
    2.5680
    2.5794
    2.5906
    2.6012
    2.6122
    2.6232
    2.6338
    2.6444
    2.6550
    2.6659
    2.6772
    2.6885
    2.6996
    2.7106
    2.7212
    2.7325
    2.7438
    2.7553
    2.7666
    2.7773
    2.7879
    2.7991
    2.8099
    2.8211
    2.8444
    2.8553
    2.8669
    2.8778
    2.8902
    2.9019
    2.9255
    2.9367
    2.9474
    2.9580
    2.9685
    2.9791
    2.9897
    3.0007
    3.0118
    3.0231
    3.0338
    3.0453
    3.0561
    3.0667
    3.0777
    3.0887
    3.0996
    3.1102
    3.1211
    3.1320
    3.1546
    3.1653
    3.1761
    3.1877
    3.1987
    3.2102
    3.2211
    3.2326
    3.2438
    3.2549
    3.2659
    3.2766
    3.2881
    3.2993
    3.3102
    3.3215
    3.3325
    3.3438
    3.3545
    3.3654
    3.3767
    3.4002
    3.4108
    3.4219
    3.4331
    3.4437
    3.4647
    3.4753
    3.4861
    3.4973
    3.5080
    3.5189
    3.5566
    3.5679
    3.5791
    3.5904
    3.6011
    3.6124
    3.6234
    3.6340
    3.6455
    3.6570
    3.6684
    3.6791
    3.6898
    3.7005
    3.7113
    3.7220
    3.7326
    3.7434
    3.7546
    3.7751
    3.7867
    3.7977
    3.8088
    3.8199
    3.8314
    3.8420
    3.8532
    3.8645
    3.8755
    3.8869
    3.8975
    3.9090
    3.9196
    3.9308
    3.9418
    3.9531
    3.9644
    3.9755
    3.9869
    3.9976
    4.0088
    4.0198
    4.0304
    4.0419
    4.0526
    4.0641
    4.0853
    4.0960
    4.1073
    4.1184
    4.1298
    4.1410
    4.1520
    4.1634
    4.1748
    4.1861
    4.1976
    4.2091
    4.2200
    4.2309
    4.2421
    4.2533
    4.2640
    4.2754
    4.2859
    4.2970
    4.3077
    4.3187
    4.3300
    4.3408
    4.3524
    4.3630
    4.3741
    4.3954
    4.4069
    4.4177
    4.4291
    4.4400
    4.4511
    4.4623
    4.4733
    4.4841
    4.5230
    4.5340
    4.5458
    4.5566
    4.5785
    4.5896
    4.6007
    4.6116
    4.6225
    4.6331
    4.6442
    4.6549
    4.6659
    4.6765
    4.6880
    4.7084
    4.7200
    4.7308
    4.7414
    4.7522
    4.7634
    4.7746
    4.7858
    4.8093
    4.8204
    4.8314
    4.8424
    4.8530
    4.8640
    4.8746
    4.8859
    4.8970
    4.9077
    4.9190
    4.9303
    4.9409
    4.9519
    4.9629
    4.9859
    4.9972
    5.0186
    5.0293
    5.0401
    5.0508
    5.0616
    5.0723
    5.0839
    5.0946
    5.1052
    5.1161
    5.1271
    5.1381
    5.1491
    5.1600
    5.1707
    5.1819
    5.1927
    5.2043
    5.2149
    5.2371
    5.2482
    5.2593
    5.2706
    5.2813
    5.2926
    5.3037
    5.3287
    5.3395
    5.3514
    5.3809
    5.3916
    5.4023
    5.4129
    5.4238
    5.4353
    5.4463
    5.4569
    5.4684
    5.4795
    5.4903
    5.5013
    5.5121
    5.5228
    5.5342
    5.5455
    5.5567
    5.5680
    5.5789
    5.5899
    5.6011
    5.6123
    5.6389
    5.6498
    5.6610
    5.6723
    5.6830
    5.6938
    5.7052
    5.7166
    5.7275
    5.7389
    5.7497
    5.7607
    5.7714
    5.7826
    5.7942
    5.8053
    5.8167
    5.8279
    5.8391
    5.8504
    5.8612
    5.8727
    5.8834
    5.8945
    5.9053
    5.9167
    5.9709
    5.9824
    6.0038
    6.0151
    6.0260
    6.0368
    6.0482
    6.0591
    6.0698
    6.0809
    6.0917
    6.1025
    6.1137
    6.1252
    6.1367
    6.1479
    6.1594
    6.1704
    6.1810
    6.1919
    6.2026
    6.2135
    6.2242
    6.2355
    6.2592
    6.2698
    6.2812
    6.2926
    6.3040
    6.3155
    6.3282
    6.3394
    6.3505
    6.3620
    6.3726
    6.3841
    6.3950
    6.4062
    6.4170
    6.4284
    6.4394
    6.4502
    6.4613
    6.4953
    6.5086
    6.5192
    6.5305
    6.5414
    6.5522
    6.5727
    6.5839
    6.6064
    6.6179


sound_time =

   1.0e+03 *

    0.0373
    0.0638
    0.1187
    0.1298
    0.1404
    0.1511
    0.1731
    0.2069
    0.2176
    0.2290
    0.2403
    0.2510
    0.2730
    0.2841
    0.2957
    0.3385
    0.3927
    0.4036
    0.4252
    0.4474
    0.4590
    0.4702
    0.4813
    0.4928
    0.5042
    0.5157
    0.5383
    0.5498
    0.5606
    0.5713
    0.5935
    0.6287
    0.6398
    0.6507
    0.6712
    0.6947
    0.7166
    0.7382
    0.7489
    0.7601
    0.7707
    0.7821
    0.7936
    0.8048
    0.8266
    0.8376
    0.8488
    0.8594
    0.8708
    0.8816
    0.8923
    0.9038
    0.9145
    0.9253
    0.9364
    0.9474
    0.9582
    0.9813
    1.0043
    1.0407
    1.0521
    1.0634
    1.0961
    1.1074
    1.1313
    1.1422
    1.1531
    1.1754
    1.2268
    1.2380
    1.2603
    1.2715
    1.3035
    1.3148
    1.3263
    1.3377
    1.3599
    1.3713
    1.3824
    1.3937
    1.4044
    1.4154
    1.4262
    1.4370
    1.4587
    1.5021
    1.5128
    1.5240
    1.5462
    1.5574
    1.5684
    1.5799
    1.6021
    1.6127
    1.6237
    1.6350
    1.6464
    1.6571
    1.6791
    1.6906
    1.7014
    1.7122
    1.7236
    1.7346
    1.7568
    1.7674
    1.7789
    1.7903
    1.8015
    1.8382
    1.8605
    1.8820
    1.8935
    1.9140
    1.9250
    1.9362
    1.9578
    1.9685
    1.9794
    1.9908
    2.0126
    2.0234
    2.0348
    2.0456
    2.0562
    2.0782
    2.0892
    2.1116
    2.1223
    2.1564
    2.1679
    2.1793
    2.1905
    2.2242
    2.2348
    2.2456
    2.2564
    2.2674
    2.2783
    2.2899
    2.3007
    2.3114
    2.3224
    2.3339
    2.3454
    2.3678
    2.3784
    2.3898
    2.4010
    2.4117
    2.4231
    2.4344
    2.4459
    2.4569
    2.4682
    2.4791
    2.4906
    2.5343
    2.5457
    2.5569
    2.5794
    2.6012
    2.6122
    2.6232
    2.6444
    2.6550
    2.6659
    2.6772
    2.6885
    2.6996
    2.7106
    2.7212
    2.7553
    2.7773
    2.7879
    2.7991
    2.8211
    2.8444
    2.8553
    2.8669
    2.8778
    2.8902
    2.9019
    2.9255
    2.9367
    2.9580
    2.9685
    2.9791
    2.9897
    3.0118
    3.0231
    3.0338
    3.0453
    3.0561
    3.0667
    3.0777
    3.0887
    3.0996
    3.1102
    3.1211
    3.1546
    3.1653
    3.1877
    3.1987
    3.2211
    3.2326
    3.2438
    3.2549
    3.2659
    3.2766
    3.2881
    3.2993
    3.3325
    3.3545
    3.3654
    3.3767
    3.4002
    3.4108
    3.4219
    3.4331
    3.4647
    3.4861
    3.4973
    3.5189
    3.5679
    3.5791
    3.5904
    3.6011
    3.6124
    3.6234
    3.6455
    3.6570
    3.6791
    3.6898
    3.7005
    3.7113
    3.7220
    3.7326
    3.7434
    3.7546
    3.7751
    3.7867
    3.7977
    3.8088
    3.8199
    3.8420
    3.8532
    3.8755
    3.8869
    3.8975
    3.9090
    3.9196
    3.9308
    3.9644
    3.9755
    3.9976
    4.0088
    4.0198
    4.0304
    4.0419
    4.0641
    4.0853
    4.0960
    4.1073
    4.1184
    4.1298
    4.1410
    4.1748
    4.1976
    4.2091
    4.2200
    4.2309
    4.2421
    4.2533
    4.2640
    4.2754
    4.2859
    4.2970
    4.3077
    4.3187
    4.3300
    4.3408
    4.3524
    4.3630
    4.3741
    4.4069
    4.4291
    4.4400
    4.4623
    4.4841
    4.5230
    4.5340
    4.5458
    4.5566
    4.5896
    4.6007
    4.6116
    4.6442
    4.6549
    4.6659
    4.6765
    4.6880
    4.7084
    4.7200
    4.7414
    4.7522
    4.7634
    4.7746
    4.7858
    4.8093
    4.8314
    4.8424
    4.8640
    4.8746
    4.8859
    4.9190
    4.9303
    4.9409
    4.9519
    4.9629
    4.9859
    4.9972
    5.0186
    5.0293
    5.0508
    5.0616
    5.0723
    5.0839
    5.0946
    5.1052
    5.1161
    5.1271
    5.1491
    5.1600
    5.1707
    5.1927
    5.2149
    5.2593
    5.2706
    5.2813
    5.2926
    5.3287
    5.3395
    5.3514
    5.3809
    5.3916
    5.4023
    5.4129
    5.4238
    5.4353
    5.4463
    5.4569
    5.4684
    5.4795
    5.4903
    5.5013
    5.5342
    5.5455
    5.5567
    5.5680
    5.5789
    5.5899
    5.6011
    5.6123
    5.6389
    5.6610
    5.6723
    5.6830
    5.6938
    5.7052
    5.7389
    5.7497
    5.7607
    5.7714
    5.7826
    5.7942
    5.8167
    5.8279
    5.8391
    5.8504
    5.8727
    5.8834
    5.8945
    5.9053
    5.9709
    5.9824
    6.0038
    6.0151
    6.0260
    6.0368
    6.0482
    6.0591
    6.0698
    6.0809
    6.0917
    6.1025
    6.1137
    6.1252
    6.1367
    6.1479
    6.1810
    6.1919
    6.2026
    6.2135
    6.2242
    6.2592
    6.2926
    6.3040
    6.3282
    6.3620
    6.3726
    6.3841
    6.3950
    6.4170
    6.4284
    6.4394
    6.4502
    6.4953
    6.5086
    6.5192
    6.5414
    6.5522
    6.5727
    6.5839
    6.6064
    6.6179

</pre><pre class="codeoutput error">Unable to resolve the name 'opto_ts.amp'.

Error in Main_Conversion2NWB (line 195)
            'data', opto_ts.amp, ...
</pre><h2 id="10">Extracellular ephys data</h2><pre class="codeinput">nprobes = 1;
nchannels_per_probe = 130; <span class="comment">%  or 384 ;</span>
variables = {<span class="string">'AP'</span>, <span class="string">'DV'</span>, <span class="string">'ML'</span>, <span class="string">'imp'</span>, <span class="string">'location'</span>, <span class="string">'filtering'</span>, <span class="string">'group'</span>, <span class="string">'group_name'</span>,<span class="string">'label'</span>}; <span class="comment">%,</span>
tbl = cell2table(cell(0, length(variables)), <span class="string">'VariableNames'</span>, variables);
device = types.core.Device(<span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'Neuropixels 3B2'</span>, <span class="keyword">...</span>
    <span class="string">'manufacturer'</span>, <span class="string">'imec'</span>);
nwb.general_devices.set(<span class="string">'array'</span>, device);


<span class="keyword">for</span> iprobe = 1:nprobes
    electrode_group = types.core.ElectrodeGroup( <span class="keyword">...</span>
        <span class="string">'description'</span>, [<span class="string">'electrode group for probe'</span> num2str(iprobe)], <span class="keyword">...</span>
        <span class="string">'location'</span>, <span class="string">'A1'</span>, <span class="keyword">...</span>
        <span class="string">'device'</span>, types.untyped.SoftLink(device) <span class="keyword">...</span>
        );
    nwb.general_extracellular_ephys.set([<span class="string">'probe'</span> num2str(iprobe)], electrode_group);
    group_object_view = types.untyped.ObjectView(electrode_group);


    <span class="keyword">for</span> ielec = 1:nchannels_per_probe

        tbl = [tbl; <span class="keyword">...</span>
            {regions.data(ielec,1)/100,<span class="keyword">...</span><span class="comment"> 'AP'</span>
            -1.*regions.data(ielec,2)/100,<span class="keyword">...</span><span class="comment"> 'DV'</span>
            regions.data(ielec,3)/100,<span class="keyword">...</span><span class="comment"> 'ML'</span>
            150000,<span class="keyword">...</span><span class="comment"> 'imp'</span>
            regions.textdata{ielec},<span class="keyword">...</span><span class="comment"> 'location'</span>
            <span class="string">'0.3-10_kHz_and_0.5-500_Hz'</span>, <span class="keyword">...</span><span class="comment"> ''</span>
            group_object_view, <span class="keyword">...</span><span class="comment"> 'group'</span>
            [<span class="string">'probe'</span> num2str(iprobe)], <span class="keyword">...</span><span class="comment">.</span>
            [<span class="string">'probe'</span> num2str(iprobe) <span class="string">'elec'</span> num2str(ielec)]}]; <span class="comment">%'label'</span>


    <span class="keyword">end</span>

<span class="keyword">end</span>


electrode_table = util.table2nwb(tbl, <span class="string">'all electrodes'</span>);
nwb.general_extracellular_ephys_electrodes = electrode_table;

<span class="comment">% Electrical serie to store voltage data</span>
electrodes_object_view = types.untyped.ObjectView( <span class="keyword">...</span>
    <span class="string">'/general/extracellular_ephys/electrodes'</span>);
electrode_table_region = types.hdmf_common.DynamicTableRegion( <span class="keyword">...</span>
    <span class="string">'table'</span>, electrodes_object_view, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'all electrodes'</span>, <span class="keyword">...</span>
    <span class="string">'data'</span>, [0:size(tbl,1)-1]'); <span class="comment">% 0 indexed!! -1</span>

electrodes_object_view2 = types.untyped.ObjectView( <span class="keyword">...</span>
    <span class="string">'/general/extracellular_ephys/electrodes'</span>);
electrode_table_region2 = types.hdmf_common.DynamicTableRegion( <span class="keyword">...</span>
    <span class="string">'table'</span>, electrodes_object_view2, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'EMG electrode'</span>, <span class="keyword">...</span>
    <span class="string">'data'</span>, [0]'); <span class="comment">% 0 indexed!!</span>




<span class="comment">% LFP electrical serie</span>
<span class="comment">% compression</span>
lfp_comp = types.untyped.DataPipe(<span class="string">'data'</span>, Lfp_data.Channel_Samples); <span class="comment">% compress lfp signal</span>
<span class="comment">% store</span>
electrical_series = types.core.ElectricalSeries( <span class="keyword">...</span>
    <span class="string">'starting_time'</span>, 0.0, <span class="keyword">...</span><span class="comment"> % seconds</span>
    <span class="string">'starting_time_rate'</span>, Lfp_data.Session_SR(1), <span class="keyword">...</span><span class="comment"> %str2double(meta_lfp.imSampRate), ... % Hz</span>
    <span class="string">'data'</span>, lfp_comp, <span class="keyword">...</span>
    <span class="string">'electrodes'</span>, electrode_table_region, <span class="keyword">...</span><span class="comment">  %% correct for all electrodes...not good right now</span>
    <span class="string">'data_unit'</span>, <span class="string">'volts'</span>,<span class="keyword">...</span>
    <span class="string">'description'</span>,<span class="string">'LFP'</span>);

<span class="comment">% Finaly store the downsampled LFP data into ecephys processing module</span>
ecephys_module = types.core.ProcessingModule(<span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'extracellular electrophysiology'</span>);
ecephys_module.nwbdatainterface.set(<span class="string">'LFP'</span>, types.core.LFP( <span class="keyword">...</span>
    <span class="string">'ElectricalSeries'</span>, electrical_series));
nwb.processing.set(<span class="string">'ecephys'</span>, ecephys_module);
</pre><h2 id="11">Spike data</h2><pre class="codeinput"><span class="comment">% remove units from our matlablab structure first</span>
<span class="keyword">if</span> ~isempty(Unit_IDX2rmv)
    <span class="keyword">for</span> ui = 1 : numel(Unit_IDX2rmv)
        uidx = Unit_IDX2rmv(ui);

        <span class="comment">% Empty spike struct</span>
        Spikes_data.Mouse_Name(uidx,:) = [];
        Spikes_data.Mouse_Genotype(uidx,:) = [];
        Spikes_data.Mouse_Sex(uidx,:) = [];
        Spikes_data.Mouse_DateOfBirth(uidx,:) = [];

        Spikes_data.Session_Counter(uidx) = [];
        Spikes_data.Session_StartTime(uidx,:) = [];
        Spikes_data.Session_Type(uidx,:) = [];
        Spikes_data.Session_Probe(uidx,:) = [];
        Spikes_data.Session_SR(uidx) = [];

        Spikes_data.Cell_Number(uidx) = [];
        Spikes_data.Cell_Cluster(uidx) = [];
        Spikes_data.Cell_Channel(uidx) = [];
        Spikes_data.Cell_Depth(uidx) = [];
        Spikes_data.Cell_Coordinates(uidx,:) = [];
        Spikes_data.Cell_Region(uidx) = [];
        Spikes_data.Cell_RegionFullName(uidx) = [];
        Spikes_data.Cell_SpikeTimes(uidx) = [];
        Spikes_data.Cell_MainSpikeWaveforms(uidx,:,:) = [];
        Spikes_data.Cell_MainSpikeWaveform(uidx,:) = [];
        Spikes_data.Cell_SpikeTemplate(uidx,:) = [];
        Spikes_data.Cell_AutoCorrelogram(uidx) = [];

        Spikes_data.Cell_spike_orientation(uidx) = [];
        Spikes_data.Cell_spike_height(uidx) = [];
        Spikes_data.Cell_spike_Peak_to_Trough(uidx) = [];
        Spikes_data.Cell_spike_PTR(uidx) = [];
        Spikes_data.Cell_spike_HW(uidx) = [];
        Spikes_data.Cell_spike_duration(uidx) = [];
        Spikes_data.Cell_spike_PeaktoOnset(uidx) = [];
        Spikes_data.Cell_spike_PeaktoBaseline(uidx) = [];
        Spikes_data.Cell_spike_PeaktoBaselineArea(uidx) = [];
        Spikes_data.Cell_spike_TroughSize(uidx) = [];
        Spikes_data.Cell_spike_PeaktoOnsetTime(uidx) = [];
        Spikes_data.Cell_spike_dVdT(uidx) = [];

        Spikes_data.Cell_spike_FS_ID(uidx) = [];
        Spikes_data.Cell_spike_RS_ID(uidx) = [];
        Spikes_data.Cell_spike_FR(uidx) = [];
        Spikes_data.Cell_spike_CV(uidx) = [];


        <span class="comment">% Empty Cell metrics</span>
        sorting_metrics.ISIviolations(uidx) = [];
        sorting_metrics.fpRate(uidx) = [];
        sorting_metrics.UnitQuality(uidx) = [];
        sorting_metrics.ContaminationRate(uidx) = [];
    <span class="keyword">end</span>
<span class="keyword">end</span>


<span class="comment">%reformat spike data</span>
num_cells = size(Spikes_data.Cell_SpikeTimes,1);
spikes = cell(1, num_cells);
channels = cell(1, num_cells);
<span class="keyword">for</span> iunit = 1:num_cells
    spikes{iunit} = [];
    spikes{iunit} = double(Spikes_data.Cell_SpikeTimes{iunit,1}{1,1})./Spikes_data.Session_SR(iunit);
    channels{iunit} = [];
    channels{iunit} = ones(1,length(spikes{iunit})).*Spikes_data.Cell_Channel(iunit);
<span class="keyword">end</span>

<span class="comment">% get waveforms</span>
wf = Spikes_data.Cell_MainSpikeWaveform';
sr = Spikes_data.Session_SR(1);

<span class="comment">% Calculate some metrics on the fly: Spike height, peak to trough ratio, peak to trough duration,</span>
<span class="comment">% half width, etc....</span>
disp([<span class="string">'Calculating a few spike metrics for file '</span> identifier <span class="string">'.nwb'</span>]);
firstquarter_idx=ceil(size(wf,1)/4);
mid_idx=round(size(wf,1)/2);

wf_metrics = [];
spike_Orientation = nan(1,size(wf,2));
spike_PeaktoOnsetTime = nan(1,size(wf,2));
spike_PeaktoOnset = nan(1,size(wf,2));
spike_duration = nan(1,size(wf,2));
spike_HW = nan(1,size(wf,2));
spike_height = nan(1,size(wf,2));
spike_PTR = nan(1,size(wf,2));
spike_Peak_to_Trough = nan(1,size(wf,2));
spike_PeaktoBaseline = nan(1,size(wf,2));
spike_PeaktoBaselineArea = nan(1,size(wf,2));
spike_TroughSize = nan(1,size(wf,2));
spike_dVdT = nan(1,size(wf,2));

<span class="keyword">for</span> i=1:size(wf,2)

    spike_shape=wf(:,i)';
    spike_shape=spike_shape-mean(spike_shape(1:round(mid_idx/2)));

    <span class="comment">% get Spike orientation</span>
    <span class="keyword">if</span> (abs(min(spike_shape)-mean(spike_shape(1:mid_idx)))) &gt;= (abs(max(spike_shape)-mean(spike_shape(1:mid_idx))))
        spike_Orientation(i) = -1;
        peakindex=find(spike_shape==min(spike_shape(firstquarter_idx:end)));
        Troughindex=find(spike_shape(peakindex+1:end)==max(spike_shape(peakindex+1:end)))+peakindex;

    <span class="keyword">elseif</span> (abs(min(spike_shape)-mean(spike_shape(1:mid_idx)))) &lt; (abs(max(spike_shape)-mean(spike_shape(1:mid_idx))))
        spike_Orientation(i) = 1;
        peakindex=find(spike_shape==max(spike_shape(firstquarter_idx:end)));
        Troughindex=find(spike_shape(peakindex+1:end)==min(spike_shape(peakindex+1:end)))+peakindex;
    <span class="keyword">end</span>

    <span class="comment">% get Peak onset time and Peak onset</span>
    onsetindex=find(abs(spike_shape(1:peakindex))&lt;=.1*abs(spike_shape(peakindex)),1,<span class="string">'last'</span>);
    spike_PeaktoOnsetTime(i)=(peakindex-onsetindex)./sr; <span class="comment">% in ms</span>
    spike_PeaktoOnset(i)=abs(spike_shape(peakindex)-spike_shape(onsetindex)); <span class="comment">% in uv</span>
    index33=find(abs(spike_shape(peakindex:end)-spike_shape(onsetindex))&lt;=.33*spike_PeaktoOnset(i),1,<span class="string">'first'</span>)+peakindex;
    <span class="keyword">if</span> isempty(index33)
        index33=numel(spike_shape);
    <span class="keyword">end</span>

    <span class="comment">% get spike duration</span>
    spike_duration(i)=(index33-peakindex)./sr; <span class="comment">% in ms</span>

    <span class="comment">% get half width</span>
    changeindex_1=find(abs(spike_shape(1:peakindex))&lt;=.5*abs(spike_shape(peakindex)),1,<span class="string">'last'</span>);
    changeindex_2=find(abs(spike_shape(peakindex:end))&lt;=.5*abs(spike_shape(peakindex)),1,<span class="string">'first'</span>)+peakindex;
    <span class="keyword">if</span> isempty(changeindex_2)
        changeindex_2=numel(spike_shape);
    <span class="keyword">end</span>
    spike_HW(i)=(changeindex_2-changeindex_1)./sr; <span class="comment">% in ms</span>

    <span class="comment">% get spike height</span>
    spike_height(i)=-spike_shape(peakindex); <span class="comment">% in uv</span>

    <span class="comment">% get peak to through ratio</span>
    <span class="keyword">if</span> ~isempty(spike_shape(Troughindex))
        spike_PTR(i)=spike_shape(Troughindex)/spike_shape(peakindex); <span class="comment">% trough to peak ratio</span>
    <span class="keyword">else</span>
        spike_PTR(i)=NaN;
    <span class="keyword">end</span>

    <span class="comment">% get peak to baseline, peak to baseline area, through size and dV/dT</span>
    <span class="keyword">if</span> peakindex ~= numel(spike_shape)
        spike_Peak_to_Trough(i)=abs(peakindex-Troughindex)./sr; <span class="comment">%  peak to trough in ms</span>
        BacktoBaselineIndex=find(abs(spike_shape(peakindex:end))&lt;=.05*abs(spike_shape(peakindex)),1,<span class="string">'first'</span>)+peakindex-1;
    <span class="keyword">elseif</span> peakindex == numel(spike_shape)
        spike_Peak_to_Trough(i)=NaN; <span class="comment">%  peak to trough in ms</span>
        BacktoBaselineIndex=numel(spike_shape);
    <span class="keyword">end</span>

    <span class="keyword">if</span> isempty(BacktoBaselineIndex)
        BacktoBaselineIndex=numel(spike_shape);
    <span class="keyword">end</span>

    <span class="keyword">if</span> peakindex ~= numel(spike_shape)
        spike_PeaktoBaseline(i)=(BacktoBaselineIndex-peakindex)/sr; <span class="comment">% in ms</span>
        spike_PeaktoBaselineArea(i)=trapz(spike_shape(peakindex:BacktoBaselineIndex));
        spike_TroughSize(i)=max(spike_shape(peakindex:end));
        spike_dVdT(i)=max(abs(diff(spike_shape(onsetindex:peakindex))))/max(abs(diff(spike_shape(peakindex:BacktoBaselineIndex))));
    <span class="keyword">elseif</span> peakindex == numel(spike_shape)
        spike_PeaktoBaseline(i)=NaN; <span class="comment">% in ms</span>
        spike_PeaktoBaselineArea(i)=NaN;
        spike_TroughSize(i)=NaN;
        spike_dVdT(i)=NaN;
    <span class="keyword">end</span>


<span class="keyword">end</span>

wf_metrics.spike_orientation=spike_Orientation;
wf_metrics.spike_height=spike_height;
wf_metrics.spike_Peak_to_Trough=spike_Peak_to_Trough;
wf_metrics.spike_PTR=spike_PTR;
wf_metrics.spike_HW=spike_HW;
wf_metrics.spike_duration=spike_duration;
wf_metrics.spike_PeaktoOnset=spike_PeaktoOnset;
wf_metrics.spike_PeaktoBaseline=spike_PeaktoBaseline;
wf_metrics.spike_PeaktoBaselineArea=spike_PeaktoBaselineArea;
wf_metrics.spike_TroughSize=spike_TroughSize;
wf_metrics.spike_PeaktoOnsetTime=spike_PeaktoOnsetTime;
wf_metrics.spike_dVdT=spike_dVdT;


<span class="comment">% Split FS and RS</span>
disp([<span class="string">'Split RSU and FSU for file '</span> identifier <span class="string">'.nwb'</span>]);

<span class="comment">% Hardcoded values working for this Neuropixels data</span>
low_tshld = 0.400;<span class="comment">%in ms</span>
high_tshld = 0.440;<span class="comment">%in ms</span>

A=wf_metrics.spike_Peak_to_Trough(wf_metrics.spike_Peak_to_Trough&lt;=low_tshld); <span class="comment">%low threshold</span>
B=wf_metrics.spike_Peak_to_Trough(wf_metrics.spike_Peak_to_Trough&gt;low_tshld &amp; wf_metrics.spike_Peak_to_Trough&lt;high_tshld);
C=wf_metrics.spike_Peak_to_Trough(wf_metrics.spike_Peak_to_Trough&gt;=high_tshld); <span class="comment">%high threshold</span>

<span class="comment">% Display the classification</span>
figure;
histogram(A,0:.02:1.5,<span class="string">'FaceColor'</span>,<span class="string">'r'</span>)
hold <span class="string">on</span>
histogram(C,0:.02:1.5,<span class="string">'FaceColor'</span>,<span class="string">'b'</span>)
histogram(B,0:.02:1.5,<span class="string">'FaceColor'</span>,[.5 .5 .5])
title([<span class="string">'Peak to Trough Histogram, '</span> identifier])
xlabel(<span class="string">'Peak to Trough (ms)'</span>);
ylabel(<span class="string">'counts'</span>);
legend(<span class="string">'Fast Spiking'</span>,<span class="string">'Regular Spiking'</span>,<span class="string">'Location'</span>,<span class="string">'northeast'</span>)
line([low_tshld low_tshld],[0 50],<span class="string">'LineWidth'</span>,1,<span class="string">'Color'</span>,[0 0 0])
line([high_tshld high_tshld],[0 50],<span class="string">'LineWidth'</span>,1,<span class="string">'Color'</span>,[0 0 0])

FS_id = zeros(1,size(wf,2));
RS_id = zeros(1,size(wf,2));

FS_id(wf_metrics.spike_Peak_to_Trough&lt;=low_tshld) = 1;
RS_id(wf_metrics.spike_Peak_to_Trough&gt;=high_tshld) = 1;

<span class="comment">% Quality metrics</span>
All_metrics = [sorting_metrics.ISIviolations' sorting_metrics.fpRate'];

<span class="comment">% Write spike data in nwb</span>
disp(<span class="string">'Add spike metrics and WS-NS classification to nwb file...'</span>)


<span class="comment">% Electrodes</span>
electrodes_object_view = types.untyped.ObjectView(<span class="string">'/general/extracellular_ephys/electrodes'</span>);

<span class="comment">% Exception case for one mouse with less channels</span>
<span class="keyword">if</span> strcmp(identifier,<span class="string">'147463_20191113-probe0'</span>) <span class="comment">%%100 channels cut form this recording</span>
    [electrodes, electrodes_index] = util.create_indexed_column(num2cell(int64(Spikes_data.Cell_Channel-1+100)),<span class="string">'/units/electrodes'</span>);
<span class="keyword">else</span>
    [electrodes, electrodes_index] = util.create_indexed_column(num2cell(int64(Spikes_data.Cell_Channel-1)),<span class="string">'/units/electrodes'</span>);

<span class="keyword">end</span>

<span class="comment">% Spike times</span>
[spike_times_vector, spike_times_index] = util.create_indexed_column(spikes,<span class="string">'spike times'</span>);


<span class="comment">% Waveforms</span>
waveform_mean = types.hdmf_common.VectorData(<span class="string">'data'</span>,wf,<span class="string">'description'</span>, <span class="string">'mean of waveform'</span>);

<span class="comment">% Filling the Unit structure</span>
nwb.units = types.core.Units( <span class="keyword">...</span>
    <span class="string">'colnames'</span>, {<span class="string">'spike_times'</span>, <span class="string">'electrodes'</span>,<span class="string">'waveform_means'</span>,<span class="keyword">...</span><span class="comment"> % Fooling pynwb while using 'waveform_meanS' so we don't get an error....</span>
    <span class="string">'quality'</span>,<span class="string">'PeaktoOnsetTime'</span>,<span class="string">'PeaktoOnset'</span>,<span class="string">'duration'</span>,<span class="string">'HW'</span>,<span class="string">'height'</span>,<span class="string">'PTR'</span>,<span class="string">'Peak_to_Trough'</span>,<span class="keyword">...</span>
    <span class="string">'PeaktoBaseline'</span>,<span class="string">'PeaktoBaselineArea'</span>,<span class="string">'TroughSize'</span>,<span class="string">'dVdT'</span>,<span class="string">'FS'</span>,<span class="string">'RS'</span>}, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'units table'</span>, <span class="keyword">...</span>
    <span class="string">'id'</span>, types.hdmf_common.ElementIdentifiers(<span class="string">'data'</span>, int64(0:length(spikes) - 1)),<span class="keyword">...</span>
    <span class="string">'spike_times'</span>,spike_times_vector,<span class="keyword">...</span>
    <span class="string">'spike_times_index'</span>,spike_times_index,<span class="keyword">...</span>
    <span class="string">'electrodes'</span>, types.hdmf_common.DynamicTableRegion(<span class="string">'table'</span>, electrodes_object_view, <span class="string">'description'</span>, <span class="string">'electrode of the Main Waveform'</span>, <span class="string">'data'</span>, electrodes.data),<span class="keyword">...</span>
    <span class="string">'waveform_means'</span>, waveform_mean,<span class="keyword">...</span>
    <span class="string">'quality'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, All_metrics',<span class="string">'description'</span>, <span class="string">'ISI violation, false positive rate'</span>),<span class="keyword">...</span>
    <span class="string">'PeaktoOnsetTime'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_PeaktoOnsetTime,<span class="string">'description'</span>, <span class="string">'Peak to Onset Time (ms)'</span>),<span class="keyword">...</span>
    <span class="string">'PeaktoOnset'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_PeaktoOnset,<span class="string">'description'</span>, <span class="string">'Peak to Onset (uV)'</span>),<span class="keyword">...</span>
    <span class="string">'duration'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_duration,<span class="string">'description'</span>, <span class="string">'duration (ms)'</span>),<span class="keyword">...</span>
    <span class="string">'HW'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_HW,<span class="string">'description'</span>, <span class="string">'Half width (ms)'</span>), <span class="keyword">...</span>
    <span class="string">'height'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_height,<span class="string">'description'</span>, <span class="string">'Height (uV)'</span>),<span class="keyword">...</span>
    <span class="string">'PTR'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_PTR,<span class="string">'description'</span>, <span class="string">'Peak to trough ratio'</span>),<span class="keyword">...</span>
    <span class="string">'Peak_to_Trough'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_Peak_to_Trough,<span class="string">'description'</span>, <span class="string">'Peak to Trough (ms)'</span>),<span class="keyword">...</span>
    <span class="string">'PeaktoBaseline'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_PeaktoBaseline,<span class="string">'description'</span>, <span class="string">'Peak to Baseline (ms)'</span>),<span class="keyword">...</span>
    <span class="string">'PeaktoBaselineArea'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_PeaktoBaselineArea,<span class="string">'description'</span>, <span class="string">'Peak to Baseline Area'</span>),<span class="keyword">...</span>
    <span class="string">'TroughSize'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_TroughSize,<span class="string">'description'</span>, <span class="string">'TroughSize (uV)'</span>),<span class="keyword">...</span>
    <span class="string">'dVdT'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, spike_dVdT,<span class="string">'description'</span>, <span class="string">'dVdT (uV.ms-1)'</span>),<span class="keyword">...</span>
    <span class="string">'FS'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, logical(FS_id),<span class="string">'description'</span>, <span class="string">'logical vector for fast spiking units'</span>),<span class="keyword">...</span>
    <span class="string">'RS'</span>,types.hdmf_common.VectorData(<span class="string">'data'</span>, logical(RS_id),<span class="string">'description'</span>, <span class="string">'logical vector for regular spiking units'</span>));
</pre><h2 id="12">Whisker angle data from DLC</h2><pre class="codeinput">whiskerangle=spikeData.WhiskerAngle{48, 1};
ts_video=spikeData.CameraTTL{48, 1} ;

whisker_angle = types.core.TimeSeries( <span class="keyword">...</span>
    <span class="string">'data'</span>, whiskerangle,<span class="keyword">...</span>
    <span class="string">'data_unit'</span>, <span class="string">'pixel'</span>,<span class="keyword">...</span>
    <span class="string">'timestamps'</span>,ts_video,<span class="keyword">...</span>
    <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>,<span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'whisker angle track from DLC'</span>);
</pre><h2 id="13">Jaw Opening data from DLC</h2><pre class="codeinput">JawCordinate=spikeData.JawCord{48, 1};
ts_video=spikeData.CameraTTL{48, 1} ;
<span class="comment">%Pupil behavioral Timeserie</span>
Jaw_Cordinate = types.core.TimeSeries( <span class="keyword">...</span>
    <span class="string">'data'</span>, JawCordinate,<span class="keyword">...</span>
    <span class="string">'data_unit'</span>, <span class="string">'pixel'</span>,<span class="keyword">...</span>
    <span class="string">'timestamps'</span>,ts_video,<span class="keyword">...</span>
    <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>,<span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'Jaw Cordinate  track from DLC'</span>);
</pre><pre class="codeinput"><span class="comment">% What else ????????????????????????????????</span>
<span class="comment">% 1- piezo lick signal</span>
<span class="comment">% 2- whiske signal</span>
<span class="comment">% 3- audio signal</span>
<span class="comment">% 4- camera ttl signal</span>
</pre><h2 id="15">Add_saturation Epochs (NON MANDATORY - CAN BE COMMENTED, some local path to change inside,...)</h2><pre class="codeinput"><span class="comment">% In some recordings the LF and AP saturate. We here detect these event with a Schmitt trigger and</span>
<span class="comment">% timestamp them so they can be removed at the start of the analysis.</span>
<span class="comment">% this part is a bit dirty...but it works...</span>


<span class="comment">% binning window</span>
bin_sz = 0.1; <span class="comment">% in seconds</span>
sr = 30000;
<span class="comment">% Allen Brain Atlas regions to count the units, this data set is PFC</span>
<span class="comment">% focussed so we will only plot these ones:</span>
Regions = {<span class="string">'MOs'</span>,<span class="string">'ACA'</span>,<span class="string">'PL'</span>,<span class="string">'ILA'</span>,<span class="string">'ORBm'</span>,<span class="string">'ORBvl'</span>,<span class="string">'ORBl'</span>};
<span class="comment">% Colors for the plot</span>
HexColors = {<span class="string">'#99B898'</span>,<span class="string">'#FECEA8'</span>,<span class="string">'#FF847C'</span>,<span class="string">'#6C5B7B'</span>,<span class="string">'#355C7D'</span>,<span class="string">'#355C7D'</span>,<span class="string">'#355C7D'</span>};

<span class="comment">% get id and recording duration from meta file</span>
id = strsplit(nwb.general_session_id,<span class="string">'_'</span>);

<span class="keyword">if</span> strcmp(id{1},<span class="string">'PL026'</span>)
    Rec_num = num2str(6);
<span class="keyword">elseif</span> strcmp(id{1},<span class="string">'PL035'</span>)
    Rec_num = num2str(3);
<span class="keyword">else</span>
    Rec_num = num2str(0);
<span class="keyword">end</span>

<span class="comment">% Load 1LFP channel</span>
lfp = nwb.processing.get(<span class="string">'ecephys'</span>).nwbdatainterface.get(<span class="string">'LFP'</span>).electricalseries.get(<span class="string">'ElectricalSeries'</span>).data;
sr_lfp = nwb.processing.get(<span class="string">'ecephys'</span>).nwbdatainterface.get(<span class="string">'LFP'</span>).electricalseries.get(<span class="string">'ElectricalSeries'</span>).starting_time_rate;
dims = size(lfp);

lfp = lfp(1,:);
t_lfp = linspace(1,round(size(lfp,2)/sr_lfp),size(lfp,2));

<span class="comment">% Get rec duration</span>
rec_dur = round(dims(2)/sr_lfp);
t = linspace(1,rec_dur,round(rec_dur/bin_sz));

<span class="comment">% Load some binarize spike data from a local folder of bin and save it</span>
<span class="comment">% somewhere.</span>
<span class="keyword">if</span> exist([<span class="string">'/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/analysis/Binned_FR/'</span> identifier  <span class="string">'_binned_fr.mat'</span>],<span class="string">'file'</span>)==2
    disp(<span class="string">'Loading spikes'</span>)
    load([<span class="string">'/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/analysis/Binned_FR/'</span> identifier  <span class="string">'_binned_fr.mat'</span>])
<span class="keyword">else</span>
    disp([<span class="string">'Loading and Binning spikes in file '</span> identifier])
    <span class="comment">% Get unit spiketimes</span>
    <span class="comment">% Load jagged arrays</span>
    unit_times_data = nwb.units.spike_times.data;
    unit_times_idx = nwb.units.spike_times_index.data;
    unit_ids = nwb.units.id.data; <span class="comment">% array of unit ids</span>
    <span class="comment">% Initialize times Map containers indexed by unit_ids</span>
    unit_times = containers.Map(<span class="string">'KeyType'</span>,class(unit_ids),<span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    last_idx = 0;
    <span class="keyword">for</span> u = 1:length(unit_ids)
        unit_id = unit_ids(u);
        s_idx = last_idx + 1;
        e_idx = unit_times_idx(u);
        unit_times(unit_id) = unit_times_data(s_idx:e_idx);
        last_idx = e_idx;
    <span class="keyword">end</span>

    <span class="comment">% Bin Spikes</span>
    spk_cnt = nan(numel(unit_ids),rec_dur/bin_sz);

    <span class="keyword">for</span> k=1:numel(unit_ids)
        spike_ts =  unit_times(k-1).*sr; <span class="comment">% -1 indexed in unit_times!!!</span>
        [fr,t,fano,~] = firing_rate(spike_ts,sr,bin_sz,rec_dur);
        spk_cnt(k,:) = fr.*bin_sz;
    <span class="keyword">end</span>

    save([<span class="string">'/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/analysis/Binned_FR/'</span> identifier  <span class="string">'_binned_fr.mat'</span>],<span class="string">'spk_cnt'</span>)
<span class="keyword">end</span>

<span class="comment">% Detect saturation epoch on the LFP</span>

<span class="comment">% Schmitt trigger for the detection</span>
Vh = double(max(lfp))-10;
Vl = double(max(lfp))-15;
[Sn]=Schmitt_Trigg(lfp,Vh,Vl);
Sn(Sn==0.5)=0;

Vh2 = double(max(lfp.*-1))-5;
Vl2 = double(max(lfp.*-1))-10;
[Sn2]=Schmitt_Trigg(lfp.*-1,Vh2,Vl2);
Sn2(Sn2==0.5)=0;

<span class="comment">% Get in timestamps</span>
dd = diff(Sn);
[~,in]=find(dd==1);
[~,out]=find(dd==-1);

dd2 = diff(Sn2);
[~,in2]=find(dd2==1);
[~,out2]=find(dd2==-1);


<span class="keyword">if</span> strcmp(id{1},<span class="string">'PL034'</span>)
    out(1)=[];
<span class="keyword">elseif</span> strcmp(id{1},<span class="string">'PL033'</span>)
    out2(1)=[];
<span class="keyword">elseif</span> strcmp(id{1},<span class="string">'PL053'</span>)
    out(1)=[];
<span class="keyword">end</span>

IN = sort([in in2]);
OUT = sort([out out2]);

<span class="comment">% remove saturation event with duration &lt;bin size</span>
idx = [];
cnt = 1;
<span class="keyword">if</span> numel(IN)&gt;numel(OUT)
    IN(end) = [];
<span class="keyword">end</span>

<span class="keyword">for</span> i = 1:numel(IN)

    <span class="keyword">if</span> (OUT(i)-IN(i))&lt;bin_sz*sr_lfp
        idx(cnt) = i;
        cnt = cnt + 1;
    <span class="keyword">end</span>
<span class="keyword">end</span>
IN(idx) = [];
OUT(idx) = [];

<span class="comment">%remove intervals with duration &lt; bin size</span>
idx2 = [];
cnt = 1;
<span class="keyword">for</span> i = 1:numel(IN)-1
    <span class="keyword">if</span> (IN(i+1)-OUT(i))&lt;bin_sz*sr_lfp
        idx2(cnt) = i;
        cnt = cnt + 1;
    <span class="keyword">end</span>
<span class="keyword">end</span>
IN(idx2+1) = [];
OUT(idx2) = [];


<span class="comment">% Write Saturation epochs in nwb</span>
<span class="keyword">if</span> isempty(IN)
    start = NaN;
    stop = NaN;
<span class="keyword">else</span>
    start = IN./sr_lfp;
    stop = OUT./sr_lfp;
<span class="keyword">end</span>

<span class="keyword">if</span> strcmp(Mouse,<span class="string">'242820'</span>) <span class="comment">% add values</span>
    start = [0 start];
    stop = [1 start];
<span class="keyword">elseif</span> strcmp(Mouse,<span class="string">'147463'</span>) <span class="comment">% add values</span>
    IN = [IN(1:2) IN(121:end)];
    OUT = [OUT(1) 6676500 OUT(121:end)];
    start = IN./sr_lfp;
    stop = OUT./sr_lfp;
<span class="keyword">end</span>

<span class="comment">% Write the LFP saturation data in the nwb file</span>
saturationIN = types.core.TimeSeries(<span class="keyword">...</span>
    <span class="string">'data'</span>, ones(1,numel(start)), <span class="keyword">...</span>
    <span class="string">'data_unit'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'start times of the LFP saturation epoch'</span>, <span class="keyword">...</span>
    <span class="string">'timestamps'</span>, start, <span class="keyword">...</span>
    <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);
saturationIN_name = <span class="string">'LFP saturation start'</span>;
saturationIN_ref = types.untyped.ObjectView([<span class="string">'/analysis/'</span>, saturationIN_name]);
nwb.analysis.set(saturationIN_name, saturationIN);

saturationOUT = types.core.TimeSeries(<span class="keyword">...</span>
    <span class="string">'data'</span>, zeros(1,numel(stop)), <span class="keyword">...</span>
    <span class="string">'data_unit'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'stop times of the LFP saturation epoch'</span>, <span class="keyword">...</span>
    <span class="string">'timestamps'</span>, stop, <span class="keyword">...</span>
    <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);
saturationOUT_name = <span class="string">'LFP saturation stop'</span>;
saturationOUT_ref = types.untyped.ObjectView([<span class="string">'/analysis/'</span>, saturationOUT_name]);
nwb.analysis.set(saturationOUT_name, saturationOUT);


disp(<span class="string">'Write LFP saturation times in nwb file'</span>)


<span class="comment">% Detect saturation epoch on the spikes</span>
pop_fr = mean(spk_cnt);

<span class="comment">% Schmitt trigger</span>
Vh = double(max(pop_fr.*-1))-0.05;
Vl = double(max(pop_fr.*-1))-0.1;
[Sn3]=Schmitt_Trigg(pop_fr.*-1,Vh,Vl);
<span class="comment">%Sn3(Sn3==0.5)=0;</span>

<span class="comment">% Get in timestamps</span>
dd3 = diff(Sn3);
[~,in3]=find(dd3==1);
[~,out3]=find(dd3==-1);

out3 = out3 + 1;


<span class="keyword">if</span> numel(in3)&gt;numel(out3)
    in3(end)=[];
<span class="keyword">end</span>

<span class="keyword">if</span> strcmp(id{1},<span class="string">'PL033'</span>)
<span class="keyword">else</span>
    <span class="comment">%remove saturation event with duration &lt;2*bin size</span>
    idx = [];
    cnt = 1;
    <span class="keyword">for</span> i = 1:numel(in3)
        <span class="keyword">if</span> (out3(i)-in3(i))&lt;bin_sz*2
            idx(cnt) = i;
            cnt = cnt + 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
    in3(idx) = [];
    out3(idx) = [];
<span class="keyword">end</span>

<span class="comment">% remove saturation events not within an LFP upward stauration</span>
idx = [];
cnt = 1;
<span class="keyword">for</span> i = 1:numel(in3)
    <span class="keyword">for</span> j = 1 : numel(start)
        <span class="keyword">if</span> (start(j)&lt;t(in3(i)) &amp;&amp; t(in3(i))&lt;stop(j)) || (start(j)&lt;t(out3(i)) &amp;&amp; t(out3(i))&lt;stop(j))
            idx(cnt) = i;
            cnt = cnt + 1;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>
in3 = in3(idx);
out3 = out3(idx);

<span class="comment">% Write Saturation epochs in nwb</span>
<span class="keyword">if</span> isempty(in3)
    start2 = NaN;
    stop2 = NaN;
<span class="keyword">else</span>
    start2 = t(in3);
    stop2 = t(out3);
<span class="keyword">end</span>

<span class="comment">% Write the spike saturation data in the nwb file</span>
saturationIN2 = types.core.TimeSeries(<span class="keyword">...</span>
    <span class="string">'data'</span>, ones(1,numel(start2)), <span class="keyword">...</span>
    <span class="string">'data_unit'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'start times of the spike saturation epoch'</span>, <span class="keyword">...</span>
    <span class="string">'timestamps'</span>, start2, <span class="keyword">...</span>
    <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);
saturationIN2_name = <span class="string">'spike saturation start'</span>;
saturationIN2_ref = types.untyped.ObjectView([<span class="string">'/analysis/'</span>, saturationIN2_name]);
nwb.analysis.set(saturationIN2_name, saturationIN2);

saturationOUT2 = types.core.TimeSeries(<span class="keyword">...</span>
    <span class="string">'data'</span>, zeros(1,numel(stop2)), <span class="keyword">...</span>
    <span class="string">'data_unit'</span>, <span class="string">'none'</span>, <span class="keyword">...</span>
    <span class="string">'description'</span>, <span class="string">'stop times of the spike saturation epoch'</span>, <span class="keyword">...</span>
    <span class="string">'timestamps'</span>, stop2, <span class="keyword">...</span>
    <span class="string">'timestamps_unit'</span>, <span class="string">'s'</span>);
saturationOUT2_name = <span class="string">'spike saturation stop'</span>;
saturationOUT2_ref = types.untyped.ObjectView([<span class="string">'/analysis/'</span>, saturationOUT2_name]);
nwb.analysis.set(saturationOUT2_name, saturationOUT2);


disp(<span class="string">'Write spike saturation times in nwb file'</span>)


<span class="comment">% Reorganize raster by PFC Region</span>
<span class="comment">% Get regions</span>
ede_regions = nwb.general_extracellular_ephys_electrodes.vectordata.get(<span class="string">'location'</span>).data;
<span class="comment">% Get unit main channel</span>
main_ch = nwb.units.electrodes.data;

region_idx = zeros(1,numel(main_ch));
<span class="keyword">for</span> R = 1:numel(Regions)
    region=char(Regions{R});
    <span class="comment">% loop over units</span>
    <span class="keyword">for</span> i = 1 : numel(main_ch)
        <span class="keyword">if</span> (strfind(char(ede_regions{main_ch(i)+1}),region)) &gt; 0 <span class="comment">%main_ch is 0 indexed !!</span>
            region_idx(i) = R;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">for</span> R = 0:numel(Regions)
    eval([<span class="string">'im'</span> num2str(R) <span class="string">' = spk_cnt(region_idx==R,:);'</span>])
<span class="keyword">end</span>


<span class="comment">% Plot the detected saturarion epochs</span>
fig1 = figure;
uu = unique(region_idx);
uu(uu==0)=[];
<span class="keyword">for</span> R = 1:numel(uu)
    eval([<span class="string">'ax'</span> num2str(R) <span class="string">' = subplot(numel(uu)+2,1,R);'</span>])
    eval([<span class="string">'imagesc('</span> <span class="string">'''XData'''</span> <span class="string">',t,'</span> <span class="string">'''CData'''</span> <span class="string">',im'</span> num2str(uu(R)) <span class="string">');'</span>])
    caxis([0, 5])
    ylabel(Regions{uu(R)})
    set(get(gca,<span class="string">'YLabel'</span>),<span class="string">'Rotation'</span>,0)
    set(gca,<span class="string">'XTickLabel'</span>,[]);
    load([<span class="string">'/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/Utilities/Colormaps/cmap_'</span> Regions{uu(R)} <span class="string">'.mat'</span>]); <span class="comment">% local color map here</span>
    colormap(flipud(gray))
    eval([<span class="string">'colormap(cmap_'</span> Regions{uu(R)} <span class="string">')'</span>])
    freezeColors <span class="comment">%freeze this plot's colormap</span>
<span class="keyword">end</span>

eval([<span class="string">'ax'</span> num2str(numel(Regions)+1) <span class="string">' = subplot(numel(Regions)+2,1,numel(Regions)+1);'</span>])
plot(t,mean(spk_cnt),<span class="string">'k'</span>)
hold <span class="string">on</span>
<span class="keyword">for</span> i = 1:numel(in3)
    line([t(in3(i)) t(in3(i))],[0 1],<span class="string">'LineWidth'</span>,1,<span class="string">'Color'</span>,[1 0 0])
    line([t(out3(i)) t(out3(i))],[0 1],<span class="string">'LineWidth'</span>,1,<span class="string">'Color'</span>,[0 0 1])
<span class="keyword">end</span>
set(gca,<span class="string">'XTickLabel'</span>,[]);
title(<span class="string">'population rate'</span>)

eval([<span class="string">'ax'</span> num2str(numel(Regions)+2) <span class="string">' = subplot(numel(Regions)+2,1,numel(Regions)+2);'</span>])
plot(t_lfp,lfp,<span class="string">'b'</span>)
hold <span class="string">on</span>
<span class="keyword">for</span> i = 1:numel(IN)
    line([t_lfp(IN(i)) t_lfp(IN(i))],[min(lfp) max(lfp)],<span class="string">'LineWidth'</span>,1,<span class="string">'Color'</span>,[1 0 0])
    line([t_lfp(OUT(i)) t_lfp(OUT(i))],[min(lfp) max(lfp)],<span class="string">'LineWidth'</span>,1,<span class="string">'Color'</span>,[0 0 1])
<span class="keyword">end</span>
title(<span class="string">'LFP'</span>)
xlabel(<span class="string">'Time(s)'</span>)

<span class="keyword">if</span> numel(uu)==3
    linkaxes([ax1,ax2,ax3,ax8,ax9],<span class="string">'x'</span>)
<span class="keyword">elseif</span> numel(uu)==4
    linkaxes([ax1,ax2,ax3,ax4,ax8,ax9],<span class="string">'x'</span>)
<span class="keyword">elseif</span> numel(uu)==5
    linkaxes([ax1,ax2,ax3,ax4,ax5,ax8,ax9],<span class="string">'x'</span>)
<span class="keyword">elseif</span> numel(uu)==6
    linkaxes([ax1,ax2,ax3,ax4,ax5,ax6,ax8,ax9],<span class="string">'x'</span>)
<span class="keyword">elseif</span> numel(uu)==7
    linkaxes([ax1,ax2,ax3,ax4,ax5,ax6,ax7,ax8,ax9],<span class="string">'x'</span>)
<span class="keyword">end</span>
set(gcf,<span class="string">'units'</span>,<span class="string">'points'</span>,<span class="string">'position'</span>,[0,2400,1200,800])
sgtitle([id{1} <span class="string">' Session '</span> id{2}])
</pre><h2 id="16">Write NWB</h2><pre class="codeinput"><span class="comment">% EXPORT TO DANDI !!! well localy first....</span>
nwbExport(nwb, [<span class="string">'/Volumes/labs/pielem/DANDI_test/'</span> identifier <span class="string">'.nwb'</span>]);
disp(<span class="string">'NWB file saved in /Volumes/labs/pielem/DANDI_test/'</span>)
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2023a</a><br></p></div><!--
##### SOURCE BEGIN #####
 
        load('Z:\analysis\Parviz_Ghaderi\ANALYSIS\DataStructure\Lastvesrion\AllData.mat')
        %%
        % Your list of mice
        Mouse_list = {'PG085'};
        M = 1  % loop over mice
        
        
        
        %% Main Parameters
        % Parameters
        Mouse = Mouse_list{M};
        probe = '-probe0'; % '' if no multiple probes
        rec_day = '';
        disp(['Processing Mouse ' Mouse probe])
        Brain_Region = 'A1';
        Task = 'Context task';
        
        % Raw Data identifiers
        
        glk_id = 0; % Spike GLX identifier
        imec_nb = 0; %imec number
        
        % Get the correct Mouse identifier from our local mouse Database (Tick@lab)
        
        probe_nb = 1; %??

        %% Loading of the data structures
        % Meta data on server
        [meta_ap] = ReadMeta(['PG085_12_13_2022_g0_t0.imec0.ap.meta'], ['D:\Neuro_Pixel_Data\PG085\RECORDING\ELECTROPHYSIOLOGY\12_13_2022\PG085_12_13_2022_g0\PG085_12_13_2022_g0_imec0']);
        [meta_lfp] = ReadMeta(['PG085_12_13_2022_g0_t0.imec0.lf.meta'], ['D:\Neuro_Pixel_Data\PG085\RECORDING\ELECTROPHYSIOLOGY\12_13_2022\PG085_12_13_2022_g0\PG085_12_13_2022_g0_imec0']);
        [meta_nidaq] = ReadMeta(['PG085_12_13_2022_g0_t0.nidq.bin'], ['D:\Neuro_Pixel_Data\PG085\RECORDING\ELECTROPHYSIOLOGY\12_13_2022\PG085_12_13_2022_g0']);
        
        % Identifier
        session = meta_ap.fileCreateTime(1:end-9);
        session(regexp(session,'-'))=[];
        identifier = [Mouse '_' session probe]; % unique identifier for saving NWB.
        
        
        
        %% Create nwb Structure
        
        nwb = NwbFile( ...
            'session_description', 'Neuropixels recording in A1 during Context dependent whisker detection task',...
            'identifier', identifier, ...
            'session_start_time', meta_ap.fileCreateTime, ...
            'general_experiment_description', 'Neuropixels recording in A1 during Context dependent whisker detection task',...
            'general_experimenter', 'Ghaderi, Raman', ... % optional
            'general_lab', 'LSENS',...
            'general_keywords', {'key3', 'key1', 'key2'},...
            'general_session_id', identifier, ... % optional
            'general_institution', 'Brain Mind Institute-EPFL',... % optional
            'general_stimulus',{'pure tone, whisker stimuls, photostim'}, ...
            'general_surgery', ['Mice were prepared for ',...
            'electrophysiology and ... ',...
            'The . ',...
            'A .... '
            ]);
        
        



        %% Subject information
        age='60'
        DOB='2022-06-13T00:00:00.000000+02:00'
        Genotype='VGAT_ChR2-eYFP'
        species=''
        sex='F'
        description= 'Mouse implanted  whisker detection task'
        
        
        subject = types.core.Subject( ...
            'subject_id', Mouse, ...
            'date_of_birth', DOB,...
            'age', age, ...
            'description',description, ...
            'species', species, ...
            'genotype', Genotype, ...
            'sex', sex);
        nwb.general_subject = subject;
        
        %% Trials
        
        
        start_time=spikeData.Behavior{48, 1}(:,1)  ;
        stop_time=start_time+5;   % trials index
        Block=repmat(1,length(start_time),1); % block index block of context or blocks of optotagging
        % sound condition of each trial
        sound=spikeData.Behavior{48, 1}(:,4) ;
        idgo=sound==0,idnogo=sound==1,idnosound=sound==3;
        sound={};
        sound(idgo)={'go tone'},sound(idnogo)={'nogo tone'},sound(idnosound)={'no tone'},
        sound_freq={};
        sound_freq(idgo)={'8 khz'},sound_freq(idnogo)={'4 khz'},sound_freq(idnosound)={'NaN'},
        sound_amp={};
        sound_amp(1:length(Block))={'80 db'}
        % whisker condition of each trial
        whisker=spikeData.Behavior{48, 1}(:,5) ;
        % lick
        lick=spikeData.Behavior{48, 1}(:,6) ;
        lick_time=repmat(200,length(Block),1);  %should go to behavior later
        %optogenetics
        optogenetics=zeros(length(Block),1)
        opto_start_time=zeros(length(Block),1)
        opto_end_time=zeros(length(Block),1)
        opto_power=zeros(length(Block),1)
        opto_freq=zeros(length(Block),1)
        
        % what else ?????????????
        





%%
%
%


        % Finally adding it to the nwb sturcture
        trials = types.core.TimeIntervals( ...
            'colnames', {'start_time', 'stop_time',...
            'Block',...
            'sound','sound_freq','sound_amp',...
            'optogenetics','opto_freq','opto_power','opto_start_time','opto_end_time',...
            'lick','lick_time'}, ...
            'description', 'trial data and properties', ...
            'id', types.hdmf_common.ElementIdentifiers('data', 0:numel(Block)-1), ... %0 indexed
            'start_time', types.hdmf_common.VectorData('data', start_time, 'description','start time of trial'), ...
            'stop_time', types.hdmf_common.VectorData('data', stop_time, 'description','end of each trial'),...
            'Block',types.hdmf_common.VectorData('data', Block', 'description','Block number'),...
            'sound',types.hdmf_common.VectorData('data', sound','description','bolean for sound'),...
            'sound_freq',types.hdmf_common.VectorData('data', sound_freq','description','sound frequency'),...
            'sound_amp',types.hdmf_common.VectorData('data', sound_amp','description','sound amplitude'),...
            'optogenetics',types.hdmf_common.VectorData('data', logical(optogenetics'),'description','bolean for optogenetics'),...
            'opto_freq',types.hdmf_common.VectorData('data', opto_freq,'description','pulse train frequency'),...
            'opto_power',types.hdmf_common.VectorData('data', opto_power,'description','laser power'),...
            'opto_start_time',types.hdmf_common.VectorData('data', opto_start_time','description','pulse duration (s)'),...
            'opto_end_time',types.hdmf_common.VectorData('data', opto_end_time','description','individual pulses timestamps'),...
            'lick',types.hdmf_common.VectorData('data', logical(lick'),'description','bolean for airpuff'),...
            'lick_time',types.hdmf_common.VectorData('data', lick_time','description','Airpuff duration (s)'));
        
        nwb.intervals_trials = trials;
        
        %% Stimuli and Optogenetic timestamps
        
        % whisker  Stimuli
        whisker_time=spikeData.Behavior{48, 1}(:,2) ;
        whisker_time=whisker_time(~isnan(whisker_time));
        WhiskerStimuli = types.core.TimeSeries(...
            'data', repmat(5,length(whisker_time),1), ...
            'data_unit', 'Volts', ...
            'description', 'whisker Amplitude in V ', ...
            'timestamps', whisker_time, ...
            'timestamps_unit', 's');
        nwb.stimulus_presentation.set('whisker_time', WhiskerStimuli);
        WhiskerStimuli_ref = types.untyped.ObjectView('/stimulus/presentation/whisker_time');
        
        
        
        % Sound stimuls
        sound_time=start_time+1.5   % or real time
        sound_time(idnosound)=[]
        sound_stimuls = types.core.TimeSeries(...
            'data', 5*ones(1,numel(sound_time)), ...
            'data_unit', 'Volts', ...
            'description', 'sound signal in V ', ...
            'timestamps', sound_time, ...
            'timestamps_unit', 's');
        nwb.stimulus_presentation.set('sound_stimuls', sound_stimuls);
        sound_stimuls_ref = types.untyped.ObjectView('/stimulus/presentation/sound_stimuls');
        
        
        % Optogenetic pulse
        % device
        laser = types.core.Device(...
            'description', 'laser-473nm', ...
            'manufacturer', '.....');
        nwb.general_devices.set('laser', laser);
        
        % stimulus site
        ogen_stim_site = types.core.OptogeneticStimulusSite( ...
            'device', types.untyped.SoftLink(laser), ...
            'description', 'PhotoStimulation (ChR2) of VGat ...', ...
            'excitation_lambda', 473.0, ...
            'location', 'wM2 ()');
        
        nwb.general_optogenetics.set('OptogeneticStimulusSite', ogen_stim_site);
        
        % Adding Timeseries to have power values
        ogen_series = types.core.OptogeneticSeries( ...
            'description', 'Optogenetic stim pulse data: pulse of .... ', ...
            'data', opto_ts.amp, ...
            'data_unit', 'mW', ...
            'site', types.untyped.SoftLink(ogen_stim_site), ...
            'timestamps', opto_ts.ts_on_corr./opto_ts.sr, ...
            'timestamps_unit', 's');
        
        nwb.stimulus_presentation.set('OptogeneticSeries', ogen_series);
        
        
        
        % and add more time series
        %
        %
        %
        %

%% Extracellular ephys data

nprobes = 1;
nchannels_per_probe = 130; %  or 384 ;
variables = {'AP', 'DV', 'ML', 'imp', 'location', 'filtering', 'group', 'group_name','label'}; %, 
tbl = cell2table(cell(0, length(variables)), 'VariableNames', variables);
device = types.core.Device(...
    'description', 'Neuropixels 3B2', ...
    'manufacturer', 'imec');
nwb.general_devices.set('array', device);


for iprobe = 1:nprobes
    electrode_group = types.core.ElectrodeGroup( ...
        'description', ['electrode group for probe' num2str(iprobe)], ...
        'location', 'A1', ...
        'device', types.untyped.SoftLink(device) ...
        );
    nwb.general_extracellular_ephys.set(['probe' num2str(iprobe)], electrode_group);
    group_object_view = types.untyped.ObjectView(electrode_group);


    for ielec = 1:nchannels_per_probe

        tbl = [tbl; ...
            {regions.data(ielec,1)/100,... 'AP'
            -1.*regions.data(ielec,2)/100,... 'DV'
            regions.data(ielec,3)/100,... 'ML'
            150000,... 'imp'
            regions.textdata{ielec},... 'location'
            '0.3-10_kHz_and_0.5-500_Hz', ... ''
            group_object_view, ... 'group'
            ['probe' num2str(iprobe)], ....
            ['probe' num2str(iprobe) 'elec' num2str(ielec)]}]; %'label'


    end

end


electrode_table = util.table2nwb(tbl, 'all electrodes');
nwb.general_extracellular_ephys_electrodes = electrode_table;

% Electrical serie to store voltage data
electrodes_object_view = types.untyped.ObjectView( ...
    '/general/extracellular_ephys/electrodes');
electrode_table_region = types.hdmf_common.DynamicTableRegion( ...
    'table', electrodes_object_view, ...
    'description', 'all electrodes', ...
    'data', [0:size(tbl,1)-1]'); % 0 indexed!! -1

electrodes_object_view2 = types.untyped.ObjectView( ...
    '/general/extracellular_ephys/electrodes');
electrode_table_region2 = types.hdmf_common.DynamicTableRegion( ...
    'table', electrodes_object_view2, ...
    'description', 'EMG electrode', ...
    'data', [0]'); % 0 indexed!!




% LFP electrical serie
% compression
lfp_comp = types.untyped.DataPipe('data', Lfp_data.Channel_Samples); % compress lfp signal
% store
electrical_series = types.core.ElectricalSeries( ...
    'starting_time', 0.0, ... % seconds
    'starting_time_rate', Lfp_data.Session_SR(1), ... %str2double(meta_lfp.imSampRate), ... % Hz
    'data', lfp_comp, ...
    'electrodes', electrode_table_region, ...  %% correct for all electrodes...not good right now
    'data_unit', 'volts',...
    'description','LFP');

% Finaly store the downsampled LFP data into ecephys processing module
ecephys_module = types.core.ProcessingModule(...
    'description', 'extracellular electrophysiology');
ecephys_module.nwbdatainterface.set('LFP', types.core.LFP( ...
    'ElectricalSeries', electrical_series));
nwb.processing.set('ecephys', ecephys_module);



%% Spike data

% remove units from our matlablab structure first
if ~isempty(Unit_IDX2rmv)
    for ui = 1 : numel(Unit_IDX2rmv)
        uidx = Unit_IDX2rmv(ui);

        % Empty spike struct
        Spikes_data.Mouse_Name(uidx,:) = [];
        Spikes_data.Mouse_Genotype(uidx,:) = [];
        Spikes_data.Mouse_Sex(uidx,:) = [];
        Spikes_data.Mouse_DateOfBirth(uidx,:) = [];

        Spikes_data.Session_Counter(uidx) = [];
        Spikes_data.Session_StartTime(uidx,:) = [];
        Spikes_data.Session_Type(uidx,:) = [];
        Spikes_data.Session_Probe(uidx,:) = [];
        Spikes_data.Session_SR(uidx) = [];

        Spikes_data.Cell_Number(uidx) = [];
        Spikes_data.Cell_Cluster(uidx) = [];
        Spikes_data.Cell_Channel(uidx) = [];
        Spikes_data.Cell_Depth(uidx) = [];
        Spikes_data.Cell_Coordinates(uidx,:) = [];
        Spikes_data.Cell_Region(uidx) = [];
        Spikes_data.Cell_RegionFullName(uidx) = [];
        Spikes_data.Cell_SpikeTimes(uidx) = [];
        Spikes_data.Cell_MainSpikeWaveforms(uidx,:,:) = [];
        Spikes_data.Cell_MainSpikeWaveform(uidx,:) = [];
        Spikes_data.Cell_SpikeTemplate(uidx,:) = [];
        Spikes_data.Cell_AutoCorrelogram(uidx) = [];

        Spikes_data.Cell_spike_orientation(uidx) = [];
        Spikes_data.Cell_spike_height(uidx) = [];
        Spikes_data.Cell_spike_Peak_to_Trough(uidx) = [];
        Spikes_data.Cell_spike_PTR(uidx) = [];
        Spikes_data.Cell_spike_HW(uidx) = [];
        Spikes_data.Cell_spike_duration(uidx) = [];
        Spikes_data.Cell_spike_PeaktoOnset(uidx) = [];
        Spikes_data.Cell_spike_PeaktoBaseline(uidx) = [];
        Spikes_data.Cell_spike_PeaktoBaselineArea(uidx) = [];
        Spikes_data.Cell_spike_TroughSize(uidx) = [];
        Spikes_data.Cell_spike_PeaktoOnsetTime(uidx) = [];
        Spikes_data.Cell_spike_dVdT(uidx) = [];

        Spikes_data.Cell_spike_FS_ID(uidx) = [];
        Spikes_data.Cell_spike_RS_ID(uidx) = [];
        Spikes_data.Cell_spike_FR(uidx) = [];
        Spikes_data.Cell_spike_CV(uidx) = [];


        % Empty Cell metrics
        sorting_metrics.ISIviolations(uidx) = [];
        sorting_metrics.fpRate(uidx) = [];
        sorting_metrics.UnitQuality(uidx) = [];
        sorting_metrics.ContaminationRate(uidx) = [];
    end
end


%reformat spike data
num_cells = size(Spikes_data.Cell_SpikeTimes,1);
spikes = cell(1, num_cells);
channels = cell(1, num_cells);
for iunit = 1:num_cells
    spikes{iunit} = [];
    spikes{iunit} = double(Spikes_data.Cell_SpikeTimes{iunit,1}{1,1})./Spikes_data.Session_SR(iunit);
    channels{iunit} = [];
    channels{iunit} = ones(1,length(spikes{iunit})).*Spikes_data.Cell_Channel(iunit);
end

% get waveforms
wf = Spikes_data.Cell_MainSpikeWaveform';
sr = Spikes_data.Session_SR(1);

% Calculate some metrics on the fly: Spike height, peak to trough ratio, peak to trough duration,
% half width, etc....
disp(['Calculating a few spike metrics for file ' identifier '.nwb']);
firstquarter_idx=ceil(size(wf,1)/4);
mid_idx=round(size(wf,1)/2);

wf_metrics = [];
spike_Orientation = nan(1,size(wf,2));
spike_PeaktoOnsetTime = nan(1,size(wf,2));
spike_PeaktoOnset = nan(1,size(wf,2));
spike_duration = nan(1,size(wf,2));
spike_HW = nan(1,size(wf,2));
spike_height = nan(1,size(wf,2));
spike_PTR = nan(1,size(wf,2));
spike_Peak_to_Trough = nan(1,size(wf,2));
spike_PeaktoBaseline = nan(1,size(wf,2));
spike_PeaktoBaselineArea = nan(1,size(wf,2));
spike_TroughSize = nan(1,size(wf,2));
spike_dVdT = nan(1,size(wf,2));

for i=1:size(wf,2)

    spike_shape=wf(:,i)';
    spike_shape=spike_shape-mean(spike_shape(1:round(mid_idx/2)));

    % get Spike orientation
    if (abs(min(spike_shape)-mean(spike_shape(1:mid_idx)))) >= (abs(max(spike_shape)-mean(spike_shape(1:mid_idx))))
        spike_Orientation(i) = -1;
        peakindex=find(spike_shape==min(spike_shape(firstquarter_idx:end)));
        Troughindex=find(spike_shape(peakindex+1:end)==max(spike_shape(peakindex+1:end)))+peakindex;

    elseif (abs(min(spike_shape)-mean(spike_shape(1:mid_idx)))) < (abs(max(spike_shape)-mean(spike_shape(1:mid_idx))))
        spike_Orientation(i) = 1;
        peakindex=find(spike_shape==max(spike_shape(firstquarter_idx:end)));
        Troughindex=find(spike_shape(peakindex+1:end)==min(spike_shape(peakindex+1:end)))+peakindex;
    end

    % get Peak onset time and Peak onset
    onsetindex=find(abs(spike_shape(1:peakindex))<=.1*abs(spike_shape(peakindex)),1,'last');
    spike_PeaktoOnsetTime(i)=(peakindex-onsetindex)./sr; % in ms
    spike_PeaktoOnset(i)=abs(spike_shape(peakindex)-spike_shape(onsetindex)); % in uv
    index33=find(abs(spike_shape(peakindex:end)-spike_shape(onsetindex))<=.33*spike_PeaktoOnset(i),1,'first')+peakindex;
    if isempty(index33)
        index33=numel(spike_shape);
    end

    % get spike duration
    spike_duration(i)=(index33-peakindex)./sr; % in ms

    % get half width
    changeindex_1=find(abs(spike_shape(1:peakindex))<=.5*abs(spike_shape(peakindex)),1,'last');
    changeindex_2=find(abs(spike_shape(peakindex:end))<=.5*abs(spike_shape(peakindex)),1,'first')+peakindex;
    if isempty(changeindex_2)
        changeindex_2=numel(spike_shape);
    end
    spike_HW(i)=(changeindex_2-changeindex_1)./sr; % in ms

    % get spike height
    spike_height(i)=-spike_shape(peakindex); % in uv

    % get peak to through ratio
    if ~isempty(spike_shape(Troughindex))
        spike_PTR(i)=spike_shape(Troughindex)/spike_shape(peakindex); % trough to peak ratio
    else
        spike_PTR(i)=NaN;
    end

    % get peak to baseline, peak to baseline area, through size and dV/dT
    if peakindex ~= numel(spike_shape)
        spike_Peak_to_Trough(i)=abs(peakindex-Troughindex)./sr; %  peak to trough in ms
        BacktoBaselineIndex=find(abs(spike_shape(peakindex:end))<=.05*abs(spike_shape(peakindex)),1,'first')+peakindex-1;
    elseif peakindex == numel(spike_shape)
        spike_Peak_to_Trough(i)=NaN; %  peak to trough in ms
        BacktoBaselineIndex=numel(spike_shape);
    end

    if isempty(BacktoBaselineIndex)
        BacktoBaselineIndex=numel(spike_shape);
    end

    if peakindex ~= numel(spike_shape)
        spike_PeaktoBaseline(i)=(BacktoBaselineIndex-peakindex)/sr; % in ms
        spike_PeaktoBaselineArea(i)=trapz(spike_shape(peakindex:BacktoBaselineIndex));
        spike_TroughSize(i)=max(spike_shape(peakindex:end));
        spike_dVdT(i)=max(abs(diff(spike_shape(onsetindex:peakindex))))/max(abs(diff(spike_shape(peakindex:BacktoBaselineIndex))));
    elseif peakindex == numel(spike_shape)
        spike_PeaktoBaseline(i)=NaN; % in ms
        spike_PeaktoBaselineArea(i)=NaN;
        spike_TroughSize(i)=NaN;
        spike_dVdT(i)=NaN;
    end


end

wf_metrics.spike_orientation=spike_Orientation;
wf_metrics.spike_height=spike_height;
wf_metrics.spike_Peak_to_Trough=spike_Peak_to_Trough;
wf_metrics.spike_PTR=spike_PTR;
wf_metrics.spike_HW=spike_HW;
wf_metrics.spike_duration=spike_duration;
wf_metrics.spike_PeaktoOnset=spike_PeaktoOnset;
wf_metrics.spike_PeaktoBaseline=spike_PeaktoBaseline;
wf_metrics.spike_PeaktoBaselineArea=spike_PeaktoBaselineArea;
wf_metrics.spike_TroughSize=spike_TroughSize;
wf_metrics.spike_PeaktoOnsetTime=spike_PeaktoOnsetTime;
wf_metrics.spike_dVdT=spike_dVdT;


% Split FS and RS
disp(['Split RSU and FSU for file ' identifier '.nwb']);

% Hardcoded values working for this Neuropixels data
low_tshld = 0.400;%in ms
high_tshld = 0.440;%in ms

A=wf_metrics.spike_Peak_to_Trough(wf_metrics.spike_Peak_to_Trough<=low_tshld); %low threshold
B=wf_metrics.spike_Peak_to_Trough(wf_metrics.spike_Peak_to_Trough>low_tshld & wf_metrics.spike_Peak_to_Trough<high_tshld);
C=wf_metrics.spike_Peak_to_Trough(wf_metrics.spike_Peak_to_Trough>=high_tshld); %high threshold

% Display the classification
figure;
histogram(A,0:.02:1.5,'FaceColor','r')
hold on
histogram(C,0:.02:1.5,'FaceColor','b')
histogram(B,0:.02:1.5,'FaceColor',[.5 .5 .5])
title(['Peak to Trough Histogram, ' identifier])
xlabel('Peak to Trough (ms)');
ylabel('counts');
legend('Fast Spiking','Regular Spiking','Location','northeast')
line([low_tshld low_tshld],[0 50],'LineWidth',1,'Color',[0 0 0])
line([high_tshld high_tshld],[0 50],'LineWidth',1,'Color',[0 0 0])

FS_id = zeros(1,size(wf,2));
RS_id = zeros(1,size(wf,2));

FS_id(wf_metrics.spike_Peak_to_Trough<=low_tshld) = 1;
RS_id(wf_metrics.spike_Peak_to_Trough>=high_tshld) = 1;

% Quality metrics
All_metrics = [sorting_metrics.ISIviolations' sorting_metrics.fpRate'];

% Write spike data in nwb
disp('Add spike metrics and WS-NS classification to nwb file...')


% Electrodes
electrodes_object_view = types.untyped.ObjectView('/general/extracellular_ephys/electrodes');

% Exception case for one mouse with less channels
if strcmp(identifier,'147463_20191113-probe0') %%100 channels cut form this recording
    [electrodes, electrodes_index] = util.create_indexed_column(num2cell(int64(Spikes_data.Cell_Channel-1+100)),'/units/electrodes');
else
    [electrodes, electrodes_index] = util.create_indexed_column(num2cell(int64(Spikes_data.Cell_Channel-1)),'/units/electrodes');

end

% Spike times
[spike_times_vector, spike_times_index] = util.create_indexed_column(spikes,'spike times');


% Waveforms
waveform_mean = types.hdmf_common.VectorData('data',wf,'description', 'mean of waveform');

% Filling the Unit structure
nwb.units = types.core.Units( ...
    'colnames', {'spike_times', 'electrodes','waveform_means',... % Fooling pynwb while using 'waveform_meanS' so we don't get an error....
    'quality','PeaktoOnsetTime','PeaktoOnset','duration','HW','height','PTR','Peak_to_Trough',...
    'PeaktoBaseline','PeaktoBaselineArea','TroughSize','dVdT','FS','RS'}, ...
    'description', 'units table', ...
    'id', types.hdmf_common.ElementIdentifiers('data', int64(0:length(spikes) - 1)),...
    'spike_times',spike_times_vector,...
    'spike_times_index',spike_times_index,...
    'electrodes', types.hdmf_common.DynamicTableRegion('table', electrodes_object_view, 'description', 'electrode of the Main Waveform', 'data', electrodes.data),...
    'waveform_means', waveform_mean,...
    'quality',types.hdmf_common.VectorData('data', All_metrics','description', 'ISI violation, false positive rate'),...
    'PeaktoOnsetTime',types.hdmf_common.VectorData('data', spike_PeaktoOnsetTime,'description', 'Peak to Onset Time (ms)'),...
    'PeaktoOnset',types.hdmf_common.VectorData('data', spike_PeaktoOnset,'description', 'Peak to Onset (uV)'),...
    'duration',types.hdmf_common.VectorData('data', spike_duration,'description', 'duration (ms)'),...
    'HW',types.hdmf_common.VectorData('data', spike_HW,'description', 'Half width (ms)'), ...
    'height',types.hdmf_common.VectorData('data', spike_height,'description', 'Height (uV)'),...
    'PTR',types.hdmf_common.VectorData('data', spike_PTR,'description', 'Peak to trough ratio'),...
    'Peak_to_Trough',types.hdmf_common.VectorData('data', spike_Peak_to_Trough,'description', 'Peak to Trough (ms)'),...
    'PeaktoBaseline',types.hdmf_common.VectorData('data', spike_PeaktoBaseline,'description', 'Peak to Baseline (ms)'),...
    'PeaktoBaselineArea',types.hdmf_common.VectorData('data', spike_PeaktoBaselineArea,'description', 'Peak to Baseline Area'),...
    'TroughSize',types.hdmf_common.VectorData('data', spike_TroughSize,'description', 'TroughSize (uV)'),...
    'dVdT',types.hdmf_common.VectorData('data', spike_dVdT,'description', 'dVdT (uV.ms-1)'),...
    'FS',types.hdmf_common.VectorData('data', logical(FS_id),'description', 'logical vector for fast spiking units'),...
    'RS',types.hdmf_common.VectorData('data', logical(RS_id),'description', 'logical vector for regular spiking units'));


%% Whisker angle data from DLC

whiskerangle=spikeData.WhiskerAngle{48, 1};  
ts_video=spikeData.CameraTTL{48, 1} ; 

whisker_angle = types.core.TimeSeries( ...
    'data', whiskerangle,...
    'data_unit', 'pixel',...
    'timestamps',ts_video,...
    'timestamps_unit', 's',...
    'description', 'whisker angle track from DLC');

%% Jaw Opening data from DLC
JawCordinate=spikeData.JawCord{48, 1};  
ts_video=spikeData.CameraTTL{48, 1} ; 
%Pupil behavioral Timeserie
Jaw_Cordinate = types.core.TimeSeries( ...
    'data', JawCordinate,...
    'data_unit', 'pixel',...
    'timestamps',ts_video,...
    'timestamps_unit', 's',...
    'description', 'Jaw Cordinate  track from DLC');

%% 


% What else ????????????????????????????????
% 1- piezo lick signal 
% 2- whiske signal 
% 3- audio signal
% 4- camera ttl signal

























































%% Add_saturation Epochs (NON MANDATORY - CAN BE COMMENTED, some local path to change inside,...)

% In some recordings the LF and AP saturate. We here detect these event with a Schmitt trigger and
% timestamp them so they can be removed at the start of the analysis.
% this part is a bit dirty...but it works...


% binning window
bin_sz = 0.1; % in seconds
sr = 30000;
% Allen Brain Atlas regions to count the units, this data set is PFC
% focussed so we will only plot these ones:
Regions = {'MOs','ACA','PL','ILA','ORBm','ORBvl','ORBl'};
% Colors for the plot
HexColors = {'#99B898','#FECEA8','#FF847C','#6C5B7B','#355C7D','#355C7D','#355C7D'};

% get id and recording duration from meta file
id = strsplit(nwb.general_session_id,'_');

if strcmp(id{1},'PL026')
    Rec_num = num2str(6);
elseif strcmp(id{1},'PL035')
    Rec_num = num2str(3);
else
    Rec_num = num2str(0);
end

% Load 1LFP channel
lfp = nwb.processing.get('ecephys').nwbdatainterface.get('LFP').electricalseries.get('ElectricalSeries').data;
sr_lfp = nwb.processing.get('ecephys').nwbdatainterface.get('LFP').electricalseries.get('ElectricalSeries').starting_time_rate;
dims = size(lfp);

lfp = lfp(1,:);
t_lfp = linspace(1,round(size(lfp,2)/sr_lfp),size(lfp,2));

% Get rec duration
rec_dur = round(dims(2)/sr_lfp);
t = linspace(1,rec_dur,round(rec_dur/bin_sz));

% Load some binarize spike data from a local folder of bin and save it
% somewhere.
if exist(['/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/analysis/Binned_FR/' identifier  '_binned_fr.mat'],'file')==2
    disp('Loading spikes')
    load(['/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/analysis/Binned_FR/' identifier  '_binned_fr.mat'])
else
    disp(['Loading and Binning spikes in file ' identifier])
    % Get unit spiketimes
    % Load jagged arrays
    unit_times_data = nwb.units.spike_times.data;
    unit_times_idx = nwb.units.spike_times_index.data;
    unit_ids = nwb.units.id.data; % array of unit ids
    % Initialize times Map containers indexed by unit_ids
    unit_times = containers.Map('KeyType',class(unit_ids),'ValueType','any');
    last_idx = 0;
    for u = 1:length(unit_ids)
        unit_id = unit_ids(u);
        s_idx = last_idx + 1;
        e_idx = unit_times_idx(u);
        unit_times(unit_id) = unit_times_data(s_idx:e_idx);
        last_idx = e_idx;
    end

    % Bin Spikes
    spk_cnt = nan(numel(unit_ids),rec_dur/bin_sz);

    for k=1:numel(unit_ids)
        spike_ts =  unit_times(k-1).*sr; % -1 indexed in unit_times!!!
        [fr,t,fano,~] = firing_rate(spike_ts,sr,bin_sz,rec_dur);
        spk_cnt(k,:) = fr.*bin_sz;
    end

    save(['/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/analysis/Binned_FR/' identifier  '_binned_fr.mat'],'spk_cnt')
end

% Detect saturation epoch on the LFP

% Schmitt trigger for the detection
Vh = double(max(lfp))-10;
Vl = double(max(lfp))-15;
[Sn]=Schmitt_Trigg(lfp,Vh,Vl);
Sn(Sn==0.5)=0;

Vh2 = double(max(lfp.*-1))-5;
Vl2 = double(max(lfp.*-1))-10;
[Sn2]=Schmitt_Trigg(lfp.*-1,Vh2,Vl2);
Sn2(Sn2==0.5)=0;

% Get in timestamps
dd = diff(Sn);
[~,in]=find(dd==1);
[~,out]=find(dd==-1);

dd2 = diff(Sn2);
[~,in2]=find(dd2==1);
[~,out2]=find(dd2==-1);


if strcmp(id{1},'PL034')
    out(1)=[];
elseif strcmp(id{1},'PL033')
    out2(1)=[];
elseif strcmp(id{1},'PL053')
    out(1)=[];
end

IN = sort([in in2]);
OUT = sort([out out2]);

% remove saturation event with duration <bin size
idx = [];
cnt = 1;
if numel(IN)>numel(OUT)
    IN(end) = [];
end

for i = 1:numel(IN)

    if (OUT(i)-IN(i))<bin_sz*sr_lfp
        idx(cnt) = i;
        cnt = cnt + 1;
    end
end
IN(idx) = [];
OUT(idx) = [];

%remove intervals with duration < bin size
idx2 = [];
cnt = 1;
for i = 1:numel(IN)-1
    if (IN(i+1)-OUT(i))<bin_sz*sr_lfp
        idx2(cnt) = i;
        cnt = cnt + 1;
    end
end
IN(idx2+1) = [];
OUT(idx2) = [];


% Write Saturation epochs in nwb
if isempty(IN)
    start = NaN;
    stop = NaN;
else
    start = IN./sr_lfp;
    stop = OUT./sr_lfp;
end

if strcmp(Mouse,'242820') % add values
    start = [0 start];
    stop = [1 start];
elseif strcmp(Mouse,'147463') % add values
    IN = [IN(1:2) IN(121:end)];
    OUT = [OUT(1) 6676500 OUT(121:end)];
    start = IN./sr_lfp;
    stop = OUT./sr_lfp;
end

% Write the LFP saturation data in the nwb file
saturationIN = types.core.TimeSeries(...
    'data', ones(1,numel(start)), ...
    'data_unit', 'none', ...
    'description', 'start times of the LFP saturation epoch', ...
    'timestamps', start, ...
    'timestamps_unit', 's');
saturationIN_name = 'LFP saturation start';
saturationIN_ref = types.untyped.ObjectView(['/analysis/', saturationIN_name]);
nwb.analysis.set(saturationIN_name, saturationIN);

saturationOUT = types.core.TimeSeries(...
    'data', zeros(1,numel(stop)), ...
    'data_unit', 'none', ...
    'description', 'stop times of the LFP saturation epoch', ...
    'timestamps', stop, ...
    'timestamps_unit', 's');
saturationOUT_name = 'LFP saturation stop';
saturationOUT_ref = types.untyped.ObjectView(['/analysis/', saturationOUT_name]);
nwb.analysis.set(saturationOUT_name, saturationOUT);


disp('Write LFP saturation times in nwb file')


% Detect saturation epoch on the spikes
pop_fr = mean(spk_cnt);

% Schmitt trigger
Vh = double(max(pop_fr.*-1))-0.05;
Vl = double(max(pop_fr.*-1))-0.1;
[Sn3]=Schmitt_Trigg(pop_fr.*-1,Vh,Vl);
%Sn3(Sn3==0.5)=0;

% Get in timestamps
dd3 = diff(Sn3);
[~,in3]=find(dd3==1);
[~,out3]=find(dd3==-1);

out3 = out3 + 1;


if numel(in3)>numel(out3)
    in3(end)=[];
end

if strcmp(id{1},'PL033')
else
    %remove saturation event with duration <2*bin size
    idx = [];
    cnt = 1;
    for i = 1:numel(in3)
        if (out3(i)-in3(i))<bin_sz*2
            idx(cnt) = i;
            cnt = cnt + 1;
        end
    end
    in3(idx) = [];
    out3(idx) = [];
end

% remove saturation events not within an LFP upward stauration
idx = [];
cnt = 1;
for i = 1:numel(in3)
    for j = 1 : numel(start)
        if (start(j)<t(in3(i)) && t(in3(i))<stop(j)) || (start(j)<t(out3(i)) && t(out3(i))<stop(j))
            idx(cnt) = i;
            cnt = cnt + 1;
        end
    end
end
in3 = in3(idx);
out3 = out3(idx);

% Write Saturation epochs in nwb
if isempty(in3)
    start2 = NaN;
    stop2 = NaN;
else
    start2 = t(in3);
    stop2 = t(out3);
end

% Write the spike saturation data in the nwb file
saturationIN2 = types.core.TimeSeries(...
    'data', ones(1,numel(start2)), ...
    'data_unit', 'none', ...
    'description', 'start times of the spike saturation epoch', ...
    'timestamps', start2, ...
    'timestamps_unit', 's');
saturationIN2_name = 'spike saturation start';
saturationIN2_ref = types.untyped.ObjectView(['/analysis/', saturationIN2_name]);
nwb.analysis.set(saturationIN2_name, saturationIN2);

saturationOUT2 = types.core.TimeSeries(...
    'data', zeros(1,numel(stop2)), ...
    'data_unit', 'none', ...
    'description', 'stop times of the spike saturation epoch', ...
    'timestamps', stop2, ...
    'timestamps_unit', 's');
saturationOUT2_name = 'spike saturation stop';
saturationOUT2_ref = types.untyped.ObjectView(['/analysis/', saturationOUT2_name]);
nwb.analysis.set(saturationOUT2_name, saturationOUT2);


disp('Write spike saturation times in nwb file')


% Reorganize raster by PFC Region
% Get regions
ede_regions = nwb.general_extracellular_ephys_electrodes.vectordata.get('location').data;
% Get unit main channel
main_ch = nwb.units.electrodes.data;

region_idx = zeros(1,numel(main_ch));
for R = 1:numel(Regions)
    region=char(Regions{R});
    % loop over units
    for i = 1 : numel(main_ch)
        if (strfind(char(ede_regions{main_ch(i)+1}),region)) > 0 %main_ch is 0 indexed !!
            region_idx(i) = R;
        end
    end
end

for R = 0:numel(Regions)
    eval(['im' num2str(R) ' = spk_cnt(region_idx==R,:);'])
end


% Plot the detected saturarion epochs
fig1 = figure;
uu = unique(region_idx);
uu(uu==0)=[];
for R = 1:numel(uu)
    eval(['ax' num2str(R) ' = subplot(numel(uu)+2,1,R);'])
    eval(['imagesc(' '''XData''' ',t,' '''CData''' ',im' num2str(uu(R)) ');'])
    caxis([0, 5])
    ylabel(Regions{uu(R)})
    set(get(gca,'YLabel'),'Rotation',0)
    set(gca,'XTickLabel',[]);
    load(['/Users/pielem/Documents/MATLAB/neuropixelPFC/Matlab/Utilities/Colormaps/cmap_' Regions{uu(R)} '.mat']); % local color map here
    colormap(flipud(gray))
    eval(['colormap(cmap_' Regions{uu(R)} ')'])
    freezeColors %freeze this plot's colormap
end

eval(['ax' num2str(numel(Regions)+1) ' = subplot(numel(Regions)+2,1,numel(Regions)+1);'])
plot(t,mean(spk_cnt),'k')
hold on
for i = 1:numel(in3)
    line([t(in3(i)) t(in3(i))],[0 1],'LineWidth',1,'Color',[1 0 0])
    line([t(out3(i)) t(out3(i))],[0 1],'LineWidth',1,'Color',[0 0 1])
end
set(gca,'XTickLabel',[]);
title('population rate')

eval(['ax' num2str(numel(Regions)+2) ' = subplot(numel(Regions)+2,1,numel(Regions)+2);'])
plot(t_lfp,lfp,'b')
hold on
for i = 1:numel(IN)
    line([t_lfp(IN(i)) t_lfp(IN(i))],[min(lfp) max(lfp)],'LineWidth',1,'Color',[1 0 0])
    line([t_lfp(OUT(i)) t_lfp(OUT(i))],[min(lfp) max(lfp)],'LineWidth',1,'Color',[0 0 1])
end
title('LFP')
xlabel('Time(s)')

if numel(uu)==3
    linkaxes([ax1,ax2,ax3,ax8,ax9],'x')
elseif numel(uu)==4
    linkaxes([ax1,ax2,ax3,ax4,ax8,ax9],'x')
elseif numel(uu)==5
    linkaxes([ax1,ax2,ax3,ax4,ax5,ax8,ax9],'x')
elseif numel(uu)==6
    linkaxes([ax1,ax2,ax3,ax4,ax5,ax6,ax8,ax9],'x')
elseif numel(uu)==7
    linkaxes([ax1,ax2,ax3,ax4,ax5,ax6,ax7,ax8,ax9],'x')
end
set(gcf,'units','points','position',[0,2400,1200,800])
sgtitle([id{1} ' Session ' id{2}])



%% Write NWB

% EXPORT TO DANDI !!! well localy first....
nwbExport(nwb, ['/Volumes/labs/pielem/DANDI_test/' identifier '.nwb']);
disp('NWB file saved in /Volumes/labs/pielem/DANDI_test/')





##### SOURCE END #####
--></body></html>